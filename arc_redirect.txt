# arc_redirect v0.1-dev
# Love redirects, hate 404s
# Andy Carter
# http://redhotchilliproject.com/

# ......................................................................
# This is a plugin for Textpattern - http://textpattern.com/
# To install: textpattern > admin > plugins
# Paste the following text into the 'Install plugin' box:
# ......................................................................

YToxMTp7czo0OiJuYW1lIjtzOjEyOiJhcmNfcmVkaXJlY3QiO3M6NzoidmVyc2lvbiI7czo3
OiIwLjEtZGV2IjtzOjY6ImF1dGhvciI7czoxMToiQW5keSBDYXJ0ZXIiO3M6MTA6ImF1dGhv
cl91cmkiO3M6MzE6Imh0dHA6Ly9yZWRob3RjaGlsbGlwcm9qZWN0LmNvbS8iO3M6MTE6ImRl
c2NyaXB0aW9uIjtzOjI1OiJMb3ZlIHJlZGlyZWN0cywgaGF0ZSA0MDRzIjtzOjU6Im9yZGVy
IjtzOjE6IjUiO3M6NDoidHlwZSI7czoxOiIxIjtzOjU6ImZsYWdzIjtzOjE6IjIiO3M6NDoi
aGVscCI7czowOiIiO3M6NDoiY29kZSI7czo1Mjg5OiJyZWdpc3Rlcl9jYWxsYmFjaygnYXJj
X3JlZGlyZWN0X2luc3RhbGwnLCdwbHVnaW5fbGlmZWN5Y2xlLmFyY19yZWRpcmVjdCcsICdp
bnN0YWxsZWQnKTsKcmVnaXN0ZXJfY2FsbGJhY2soJ2FyY19yZWRpcmVjdF91bmluc3RhbGwn
LCdwbHVnaW5fbGlmZWN5Y2xlLmFyY19yZWRpcmVjdCcsICdkZWxldGVkJyk7CnJlZ2lzdGVy
X2NhbGxiYWNrKCdhcmNfcmVkaXJlY3QnLCAndHhwX2RpZScsIDQwNCk7CmFkZF9wcml2cygn
YXJjX3JlZGlyZWN0JywgJzEsMiwzLDQnKTsKcmVnaXN0ZXJfdGFiKCdleHRlbnNpb25zJywg
J2FyY19yZWRpcmVjdCcsICdhcmNfcmVkaXJlY3QnKTsKcmVnaXN0ZXJfY2FsbGJhY2soJ2Fy
Y19yZWRpcmVjdF90YWInLCAnYXJjX3JlZGlyZWN0Jyk7CgovKgogKiBDaGVjayBmb3IgcmVk
aXJlY3RlZCBVUkxzIGFuZCBmb3J3YXJkIHdpdGggYSAzMDEgd2hlcmUgbmVjZXNzYXJ5Lgog
Ki8KZnVuY3Rpb24gYXJjX3JlZGlyZWN0KCRldmVudCwgJHN0ZXApIHsKICAkdXJsID0gUFJP
VE9DT0wuJF9TRVJWRVJbJ1NFUlZFUl9OQU1FJ10uJF9TRVJWRVJbJ1JFUVVFU1RfVVJJJ107
CgogICRzcWwgPSAiU0VMRUNUIHJlZGlyZWN0VXJsIEZST00gIi5QRlguImFyY19yZWRpcmVj
dCBXSEVSRSBvcmlnaW5hbFVybCA9ICciLiR1cmwuIic7IjsKICAkcnMgPSBzYWZlX3F1ZXJ5
KCRzcWwpOyAkcmVkaXJlY3QgPSBuZXh0Um93KCRycyk7CgoJICBpZiAoJHJlZGlyZWN0Wydy
ZWRpcmVjdFVybCddKSB7CgkJICBvYl9lbmRfY2xlYW4oKTsKCgkJICBoZWFkZXIoIlN0YXR1
czogMzAxIik7CgkJICBoZWFkZXIoIkhUVFAvMS4wIDMwMSBNb3ZlZCBQZXJtYW5lbnRseSIp
OwoJCSAgaGVhZGVyKCJMb2NhdGlvbjogIi4kcmVkaXJlY3RbJ3JlZGlyZWN0VXJsJ10sIFRS
VUUsIDMwMSk7CgoJCSAgLy8gSW4gY2FzZSB0aGUgaGVhZGVyKCkgbWV0aG9kIGZhaWxzLCBm
YWxsIGJhY2sgb24gYSBjbGFzc2ljIHJlZGlyZWN0CgkJICBlY2hvICc8aHRtbD48aGVhZD48
TUVUQSBIVFRQLUVRVUlWPSJSZWZyZXNoIiBDT05URU5UPSIwO1VSTD0nCgkJICAgIC4kcGVy
bWxpbmsuJyI+PC9oZWFkPjxib2R5PjwvYm9keT48L2h0bWw+JzsKCQkgIGRpZSgpOwoJICB9
Cgp9CgpmdW5jdGlvbiBhcmNfcmVkaXJlY3RfdGFiKCRldmVudCwgJHN0ZXApIHsKICBzd2l0
Y2ggKCRzdGVwKSB7CiAgICBjYXNlICdhZGQnOiBhcmNfcmVkaXJlY3RfYWRkKCk7IGJyZWFr
OwogICAgY2FzZSAnc2F2ZSc6IGFyY19yZWRpcmVjdF9zYXZlKCk7IGJyZWFrOwogICAgY2Fz
ZSAnZWRpdCc6IGFyY19yZWRpcmVjdF9lZGl0KCk7IGJyZWFrOwogICAgZGVmYXVsdDogYXJj
X3JlZGlyZWN0X2xpc3QoKTsKICB9Cn0KCmZ1bmN0aW9uIGFyY19yZWRpcmVjdF9saXN0KCRt
ZXNzYWdlID0gJycpIHsKCiAgcGFnZXRvcCgnYXJjX3JlZGlyZWN0JywkbWVzc2FnZSk7Cgog
ICRzcWwgPSAiU0VMRUNUICogRlJPTSAiLlBGWC4iYXJjX3JlZGlyZWN0OyI7CiAgJHJzID0g
c2FmZV9xdWVyeSgkc3FsKTsKCiAgLy8gSW5jbHVkZSBhIHF1aWNrIGFkZCBmb3JtCiAgJGh0
bWwgPSBmb3JtKAogICAgc3RhcnRUYWJsZSgnZWRpdCcpCiAgICAgIC50cigKICAgICAgICB0
ZGEodGFnKCdPcmlnaW5hbCBVUkwnLCdsYWJlbCcsICcgZm9yPSJvcmlnaW5hbFVybCInKSwn
IHN0eWxlPSJ2ZXJ0aWNhbC1hbGlnbjptaWRkbGUiJykKICAgICAgICAudGQoZklucHV0KCd0
ZXh0Jywnb3JpZ2luYWxVcmwnLCcnLCdlZGl0JywnJywnJywnJywnJywnb3JpZ2luYWxVcmwn
KSkKICAgICAgKS50cigKICAgICAgICB0ZGEodGFnKCdSZWRpcmVjdCBVUkwnLCdsYWJlbCcs
ICcgZm9yPSJyZWRpcmVjdFVybCInKSwnIHN0eWxlPSJ2ZXJ0aWNhbC1hbGlnbjptaWRkbGUi
JykKICAgICAgICAudGQoZklucHV0KCd0ZXh0JywncmVkaXJlY3RVcmwnLCcnLCdlZGl0Jywn
JywnJywnJywnJywncmVkaXJlY3RVcmwnKQogICAgICAgIC5lSW5wdXQoJ2FyY19yZWRpcmVj
dCcpCiAgICAgICAgLnNJbnB1dCgnYWRkJykuJyZuYnNwOycuZklucHV0KCdzdWJtaXQnLCdh
ZGQnLGdUeHQoJ0FkZCcpLCdwdWJsaXNoJykKICAgICAgICApCiAgICAgICkKICAgIC5lbmRU
YWJsZSgpCiAgLCAnbWFyZ2luLWJvdHRvbToyNXB4Jyk7CgogIC8vIEFkZCBhIGxpc3Qgb2Yg
ZXhpc3RpbmcgcmVkaXJlY3RzCiAgJGh0bWwgLj0gc3RhcnRUYWJsZSgnbGlzdCcpOwoKICAk
aHRtbCAuPSB0cigKICAgIGhDZWxsICgnSUQjJykKICAgIC5oQ2VsbCAoKQogICAgLmhDZWxs
ICgnT3JpZ2luYWwgVVJMJykKICAgIC5oQ2VsbCAoJ1JlZGlyZWN0IFVSTCcpCiAgKTsKCiAg
d2hpbGUgKCRyZWRpcmVjdCA9IG5leHRSb3coJHJzKSkgewogICAgJGVkaXRMaW5rID0gaHJl
ZihnVHh0KCdlZGl0JyksCiAgICAgICc/ZXZlbnQ9YXJjX3JlZGlyZWN0JmFtcDtzdGVwPWVk
aXQmYW1wO2lkPScuJHJlZGlyZWN0WydhcmNfcmVkaXJlY3RJRCddKTsKICAgICRodG1sIC49
IHRyKAogICAgICB0ZCgkcmVkaXJlY3RbJ2FyY19yZWRpcmVjdElEJ10sIDIwLCAnaWQnKQog
ICAgICAudGQoIjx1bD48bGkgY2xhc3M9J2FjdGlvbi1lZGl0Jz4kZWRpdExpbms8L2xpPjwv
dWw+IiwgMzUsICdhY3Rpb25zJykKICAgICAgLnRkKCRyZWRpcmVjdFsnb3JpZ2luYWxVcmwn
XSwgMTc1KQogICAgICAudGQoJHJlZGlyZWN0WydyZWRpcmVjdFVybCddLCAxNzUpCiAgICAp
OwogIH0KCiAgJGh0bWwgLj0gZW5kVGFibGUoKTsKCiAgZWNobyAkaHRtbDsKCn0KCmZ1bmN0
aW9uIGFyY19yZWRpcmVjdF9lZGl0KCRtZXNzYWdlPScnKSB7CiAgcGFnZXRvcCgnYXJjX3Jl
ZGlyZWN0JywkbWVzc2FnZSk7CgogICRvcmlnaW5hbFVybCA9IGdwcygnb3JpZ2luYWxVcmwn
KTsKICAkcmVkaXJlY3RVcmwgPSBncHMoJ3JlZGlyZWN0VXJsJyk7CgogIGlmICgkaWQ9Z3Bz
KCdpZCcpKSB7CiAgICAkcnMgPSBzYWZlX3Jvdygnb3JpZ2luYWxVcmwscmVkaXJlY3RVcmwn
LCAnYXJjX3JlZGlyZWN0JywgImFyY19yZWRpcmVjdElEID0gJGlkIik7CiAgICBleHRyYWN0
KCRycyk7CiAgfQoKICBlY2hvIHN0YXJ0VGFibGUoJ2VkaXQnKS50cih0ZCgKCiAgICBmb3Jt
KAogICAgICB0YWcodGFnKCdPcmlnaW5hbCBVUkwnLCdsYWJlbCcsICcgZm9yPSJvcmlnaW5h
bFVybCInKQogICAgICAuZklucHV0KCd0ZXh0Jywnb3JpZ2luYWxVcmwnLCRvcmlnaW5hbFVy
bCwnZWRpdCcsJycsJycsJycsJycsJ29yaWdpbmFsVXJsJyksJ3AnKQogICAgICAudGFnKHRh
ZygnUmVkaXJlY3QgVVJMJywnbGFiZWwnLCAnIGZvcj0icmVkaXJlY3RVcmwiJykKICAgICAg
LmZJbnB1dCgndGV4dCcsJ3JlZGlyZWN0VXJsJywkcmVkaXJlY3RVcmwsJ2VkaXQnLCcnLCcn
LCcnLCcnLCdyZWRpcmVjdFVybCcpLCdwJykKICAgICAgLmVJbnB1dCgnYXJjX3JlZGlyZWN0
JykKICAgICAgLigoJGlkKT8KICAgICAgICBzSW5wdXQoJ3NhdmUnKS5oSW5wdXQoJ2lkJywk
aWQpLmZJbnB1dCgnc3VibWl0Jywnc2F2ZScsZ1R4dCgnU2F2ZScpLCdwdWJsaXNoJykKICAg
ICAgICA6c0lucHV0KCdhZGQnKS5mSW5wdXQoJ3N1Ym1pdCcsJ2FkZCcsZ1R4dCgnQWRkJyks
J3B1Ymxpc2gnKQogICAgICApLmJyCiAgICApCiAgKSkuZW5kVGFibGUoKTsKCn0KCmZ1bmN0
aW9uIGFyY19yZWRpcmVjdF9hZGQoKSB7CiAgJG9yaWdpbmFsVXJsID0gZ3BzKCdvcmlnaW5h
bFVybCcpOwogICRyZWRpcmVjdFVybCA9IGdwcygncmVkaXJlY3RVcmwnKTsKCiAgaWYgKCRv
cmlnaW5hbFVybCA9PT0gJycgfHwgJHJlZGlyZWN0VXJsID09PSAnJykgewogICAgYXJjX3Jl
ZGlyZWN0X2VkaXQoJ1VuYWJsZSB0byBhZGQgbmV3IHJlZGlyZWN0Jyk7CiAgICByZXR1cm47
CiAgfQoKICAkcSA9IHNhZmVfaW5zZXJ0KCJhcmNfcmVkaXJlY3QiLAogICAgIm9yaWdpbmFs
VXJsID0gJyIudHJpbSgkb3JpZ2luYWxVcmwpLiInLCByZWRpcmVjdFVybCA9ICciLnRyaW0o
JHJlZGlyZWN0VXJsKS4iJyIKICApOwoKICAkR0xPQkFMU1snSUQnXSA9IG15c3FsX2luc2Vy
dF9pZCgpOwoKICBpZiAoJHEpIHsKICAgICRtZXNzYWdlID0gZ1R4dCgnUmVkaXJlY3QgYWRk
ZWQnKTsKICAgIGFyY19yZWRpcmVjdF9saXN0KCRtZXNzYWdlKTsKICB9Cn0KCmZ1bmN0aW9u
IGFyY19yZWRpcmVjdF9zYXZlKCkgewoKICBpZiAoISRpZD1ncHMoJ2lkJykpIHsKICAgIGFy
Y19yZWRpcmVjdF9saXN0KCdVbmFibGUgdG8gc2F2ZSByZWRpcmVjdCcpOwogICAgcmV0dXJu
OwogIH0KCiAgJG9yaWdpbmFsVXJsID0gZ3BzKCdvcmlnaW5hbFVybCcpOwogICRyZWRpcmVj
dFVybCA9IGdwcygncmVkaXJlY3RVcmwnKTsKCiAgaWYgKCRvcmlnaW5hbFVybCA9PSAnJyB8
fCAkcmVkaXJlY3RVcmwgPT0gJycpIHsKICAgIGFyY19yZWRpcmVjdF9lZGl0KCdVbmFibGUg
dG8gc2F2ZSByZWRpcmVjdCcpOwogICAgcmV0dXJuOwogIH0KCiAgJHJzID0gc2FmZV91cGRh
dGUoImFyY19yZWRpcmVjdCIsCiAgICAib3JpZ2luYWxVcmwgICAgPSAnIi50cmltKCRvcmln
aW5hbFVybCkuIicsICByZWRpcmVjdFVybCA9ICciLnRyaW0oJHJlZGlyZWN0VXJsKS4iJyIs
CiAgICAiYXJjX3JlZGlyZWN0SUQgPSAkaWQiCiAgKTsKCiAgaWYgKCRycykgewogICAgJG1l
c3NhZ2UgPSBnVHh0KCdSZWRpcmVjdCB1cGRhdGVkJyk7CiAgICBhcmNfcmVkaXJlY3RfbGlz
dCgkbWVzc2FnZSk7CiAgfQp9CgovLyBJbnN0YWxsYXRpb24gZnVuY3Rpb24gLSBidWlsZHMg
TXlTUUwgdGFibGUKZnVuY3Rpb24gYXJjX3JlZGlyZWN0X2luc3RhbGwoKQp7CgogIC8vIEZv
ciBmaXJzdCBpbnN0YWxsLCBjcmVhdGUgdGFibGUgZm9yIHR3ZWV0cwogICRzcWwgPSAiQ1JF
QVRFIFRBQkxFIElGIE5PVCBFWElTVFMgIi5QRlguImFyY19yZWRpcmVjdCAiOwogICRzcWwu
PSAiKGFyY19yZWRpcmVjdElEIElOVEVHRVIgQVVUT19JTkNSRU1FTlQgUFJJTUFSWSBLRVks
CiAgICBvcmlnaW5hbFVybCBWQVJDSEFSKDI0MCksCiAgICByZWRpcmVjdFVybCBWQVJDSEFS
KDI0MCkpOyI7CgogIGlmICghc2FmZV9xdWVyeSgkc3FsKSkgewogICAgcmV0dXJuICdFcnJv
ciAtIHVuYWJsZSB0byBjcmVhdGUgYXJjX3JlZGlyZWN0IHRhYmxlJzsKICB9Cgp9CgovLyBV
bmluc3RhbGwgZnVuY3Rpb24gLSBkZWxldGVzIE15U1FMIHRhYmxlIGFuZCByZWxhdGVkIHBy
ZWZlcmVuY2VzCgpmdW5jdGlvbiBhcmNfcmVkaXJlY3RfdW5pbnN0YWxsKCkKewogICRzcWwg
PSAiRFJPUCBUQUJMRSBJRiBFWElTVFMgIi5QRlguImFyY19yZWRpcmVjdDsiOwogIGlmICgh
c2FmZV9xdWVyeSgkc3FsKSkgewogICAgcmV0dXJuICdFcnJvciAtIHVuYWJsZSB0byBkZWxl
dGUgYXJjX3JlZGlyZWN0IHRhYmxlJzsKICB9Cn0iO3M6MzoibWQ1IjtzOjMyOiI4ZjQwOGJj
MmVmNDc5ODNlNGUyNDg4MmJmNjM1YzU1MiI7fQ==
