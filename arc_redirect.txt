# arc_redirect v1.0beta
# Love redirects, hate 404s
# Andy Carter
# http://redhotchilliproject.com/

# ......................................................................
# This is a plugin for Textpattern - http://textpattern.com/
# To install: textpattern > admin > plugins
# Paste the following text into the 'Install plugin' box:
# ......................................................................

YToxMTp7czo0OiJuYW1lIjtzOjEyOiJhcmNfcmVkaXJlY3QiO3M6NzoidmVyc2lvbiI7czo3
OiIxLjBiZXRhIjtzOjY6ImF1dGhvciI7czoxMToiQW5keSBDYXJ0ZXIiO3M6MTA6ImF1dGhv
cl91cmkiO3M6MzE6Imh0dHA6Ly9yZWRob3RjaGlsbGlwcm9qZWN0LmNvbS8iO3M6MTE6ImRl
c2NyaXB0aW9uIjtzOjI1OiJMb3ZlIHJlZGlyZWN0cywgaGF0ZSA0MDRzIjtzOjU6Im9yZGVy
IjtzOjE6IjUiO3M6NDoidHlwZSI7czoxOiIxIjtzOjU6ImZsYWdzIjtzOjE6IjIiO3M6NDoi
aGVscCI7czoyMTU4OiIJPGgxIGNsYXNzPSJ0aXRsZSI+YXJjX3JlZGlyZWN0IChsb3ZlIHJl
ZGlyZWN0cywgaGF0ZSA0MDRzKTwvaDE+CgoJPHA+SWYgeW91JiM4MjE3O3JlIGluIHRoZSBw
cm9jZXNzIG9mIHJlc3RydWN0dXJpbmcgYSBUZXh0cGF0dGVybiBzaXRlLCB0aGVuIHRoaXMg
aXMgdGhlIHBsdWdpbiBmb3IgeW91ITwvcD4KCgk8cD5SZXF1aXJlbWVudHM6LTwvcD4KCgk8
dWw+CgkJPGxpPlRleHRwYXR0ZXJuIDQuMis8L2xpPgoJPC91bD4KCgk8aDIgY2xhc3M9InNl
Y3Rpb24iPkF1dGhvcjwvaDI+CgoJPHA+PGEgaHJlZj0iaHR0cDovL3JlZGhvdGNoaWxsaXBy
b2plY3QuY29tIj5BbmR5IENhcnRlcjwvYT4uIEZvciBvdGhlciBUZXh0cGF0dGVybiBwbHVn
aW5zIGJ5IG1lIHZpc2l0IG15IDxhIGhyZWY9Imh0dHA6Ly9yZWRob3RjaGlsbGlwcm9qZWN0
LmNvbS90eHAiPlBsdWdpbnMgcGFnZTwvYT4uPC9wPgoKCTxwPlRoYW5rcyB0byA8YSBocmVm
PSJodHRwOi8vb2xpdmVya2VyLmNvLnVrLyI+T2xpdmVyIEtlcjwvYT4gZm9yIGdpdmluZyBt
ZSB0aGUgaWRlYSBmb3IgdGhpcyBwbHVnaW4uPC9wPgoKCTxoMiBjbGFzcz0ic2VjdGlvbiI+
SW5zdGFsbGF0aW9uIC8gVW5pbnN0YWxsYXRpb248L2gyPgoKCTxwPlRvIGluc3RhbGwgZ28g
dG8gdGhlICYjODIxNjtwbHVnaW5zJiM4MjE3OyB0YWIgdW5kZXIgJiM4MjE2O2FkbWluJiM4
MjE3OyBhbmQgcGFzdGUgdGhlIHBsdWdpbiBjb2RlIGludG8gdGhlICYjODIxNjtJbnN0YWxs
IHBsdWdpbiYjODIxNzsgYm94LCAmIzgyMTY7dXBsb2FkJiM4MjE3OyBhbmQgdGhlbiAmIzgy
MTY7aW5zdGFsbCYjODIxNzsuIEZpbmFsbHkgYWN0aXZhdGUgdGhlIHBsdWdpbi48L3A+CgoJ
PHA+VG8gdW5pbnN0YWxsIDxzcGFuIGNsYXNzPSJ0YWciPmFyY19yZWRpcmVjdDwvc3Bhbj4g
c2ltcGx5IGRlbGV0ZSB0aGUgcGx1Z2luIGZyb20gdGhlICYjODIxNjtQbHVnaW5zJiM4MjE3
OyB0YWIuICBUaGlzIHdpbGwgcmVtb3ZlIHRoZSBwbHVnaW4gY29kZSBhbmQgZHJvcCB0aGUg
PHNwYW4gY2xhc3M9InRhZyI+YXJjX3JlZGlyZWN0PC9zcGFuPiB0YWJsZSBmcm9tIHlvdXIg
VGV4dHBhdHRlcm4gZGF0YWJhc2UuPC9wPgoKCTxoMiBjbGFzcz0ic2VjdGlvbiI+VXNhZ2U8
L2gyPgoKCTxwPjxzcGFuIGNsYXNzPSJ0YWciPmFyY19yZWRpcmVjdDwvc3Bhbj4gYWRkcyBh
IG5ldyB0YWIgdW5kZXIgJiM4MjE2O0V4dGVuc2lvbnMmIzgyMTc7IGZyb20gd2hlcmUgeW91
IGNhbiBkZWZpbmUgcGFpcnMgb2YgPHNwYW4gY2xhc3M9ImNhcHMiPlVSTDwvc3Bhbj5zIGZv
ciBoYW5kbGluZyByZWRpcmVjdHMuIEJhc2ljYWxseSBwcm92aWRlIGFuIG9yaWdpbmFsIDxz
cGFuIGNsYXNzPSJjYXBzIj5VUkw8L3NwYW4+IG9uIHlvdXIgVGV4dHBhdHRlcm4gc2l0ZSB0
aGF0IGlzIGdlbmVyYXRpbmcgYSA0MDQsICYjODIyMDtwYWdlIG5vdCBmb3VuZCYjODIyMTss
IGVycm9yIGFuZCBhIHJlZGlyZWN0IDxzcGFuIGNsYXNzPSJjYXBzIj5VUkw8L3NwYW4+LiBU
aGVuIHdoZW5ldmVyIHNvbWVvbmUgZ29lcyB0byB0aGUgb3JpZ2luYWwgPHNwYW4gY2xhc3M9
ImNhcHMiPlVSTDwvc3Bhbj4gcmF0aGVyIHRoYW4gZ2V0IHRoZSBzdGFuZGFyZCA0MDQgZXJy
b3IgcGFnZSB0aGV5IHdpbGwgYmUgcmVkaXJjdGVkIHRvIHRoZSBuZXcgPHNwYW4gY2xhc3M9
ImNhcHMiPlVSTDwvc3Bhbj4gKHdpdGggYSAzMDEgcGVybWVuYW50ZWx5IG1vdmVkKS48L3A+
CgoJPHA+VGhlIG9yaWdpbmFsIDxzcGFuIGNsYXNzPSJjYXBzIj5VUkw8L3NwYW4+IG11c3Qg
cHJvZHVjZSBhIDQwNCBwYWdlIGluIFRleHRwYXR0ZXJuIG9uIHRoZSBzaXRlIHRoaXMgcGx1
Z2luIGlzIGluc3RhbGxlZC48L3A+CgoJPHVsPgoJCTxsaT48c3BhbiBjbGFzcz0idGFnIj5h
cmNfcmVkaXJlY3Q8L3NwYW4+IHRyZWF0cyBodHRwOi8vd3d3LmV4YW1wbGUuY29tL21pc3Np
bmcgdGhlIHNhbWUgYXMgaHR0cDovL3d3dy5leGFtcGxlLmNvbS9taXNzaW5nLzwvbGk+CgkJ
PGxpPjxzcGFuIGNsYXNzPSJ0YWciPmFyY19yZWRpcmVjdDwvc3Bhbj4gZG9lcyBub3QgdHJl
YXQgaHR0cDovL2V4YW1wbGUuY29tL21pc3NpbmcgYW5kIGh0dHA6Ly93d3cuZXhhbXBsZS5j
b20vbWlzc2luZyBhcyB0aGUgc2FtZSA8c3BhbiBjbGFzcz0iY2FwcyI+VVJMPC9zcGFuPjwv
bGk+Cgk8L3VsPgoKIjtzOjQ6ImNvZGUiO3M6NzQ5NjoicmVnaXN0ZXJfY2FsbGJhY2soJ2Fy
Y19yZWRpcmVjdF9pbnN0YWxsJywncGx1Z2luX2xpZmVjeWNsZS5hcmNfcmVkaXJlY3QnLCAn
aW5zdGFsbGVkJyk7CnJlZ2lzdGVyX2NhbGxiYWNrKCdhcmNfcmVkaXJlY3RfdW5pbnN0YWxs
JywncGx1Z2luX2xpZmVjeWNsZS5hcmNfcmVkaXJlY3QnLCAnZGVsZXRlZCcpOwpyZWdpc3Rl
cl9jYWxsYmFjaygnYXJjX3JlZGlyZWN0JywgJ3R4cF9kaWUnLCA0MDQpOwphZGRfcHJpdnMo
J2FyY19yZWRpcmVjdCcsICcxLDIsMyw0Jyk7CnJlZ2lzdGVyX3RhYignZXh0ZW5zaW9ucycs
ICdhcmNfcmVkaXJlY3QnLCAnYXJjX3JlZGlyZWN0Jyk7CnJlZ2lzdGVyX2NhbGxiYWNrKCdh
cmNfcmVkaXJlY3RfdGFiJywgJ2FyY19yZWRpcmVjdCcpOwoKLyoKICogQ2hlY2sgZm9yIHJl
ZGlyZWN0ZWQgVVJMcyBhbmQgZm9yd2FyZCB3aXRoIGEgMzAxIHdoZXJlIG5lY2Vzc2FyeS4K
ICovCmZ1bmN0aW9uIGFyY19yZWRpcmVjdCgkZXZlbnQsICRzdGVwKSB7CiAgJHVybCA9IFBS
T1RPQ09MLiRfU0VSVkVSWydTRVJWRVJfTkFNRSddLiRfU0VSVkVSWydSRVFVRVNUX1VSSSdd
OwoKICAvLyBTdHJpcCBmaW5hbCBzbGFzaCBmcm9tIHVybAogIGlmIChzdWJzdHIoJHVybCwt
MSk9PScvJykgeyAkdXJsID0gc3Vic3RyKCR1cmwsIDAsIC0xKTsgfQoKICAkc3FsID0gIlNF
TEVDVCByZWRpcmVjdFVybCBGUk9NICIuUEZYLiJhcmNfcmVkaXJlY3QgV0hFUkUgb3JpZ2lu
YWxVcmwgPSAnIi4kdXJsLiInOyI7CiAgJHJzID0gc2FmZV9xdWVyeSgkc3FsKTsgJHJlZGly
ZWN0ID0gbmV4dFJvdygkcnMpOwoKCSAgaWYgKCRyZWRpcmVjdFsncmVkaXJlY3RVcmwnXSkg
ewoJCSAgb2JfZW5kX2NsZWFuKCk7CgoJCSAgaGVhZGVyKCJTdGF0dXM6IDMwMSIpOwoJCSAg
aGVhZGVyKCJIVFRQLzEuMCAzMDEgTW92ZWQgUGVybWFuZW50bHkiKTsKCQkgIGhlYWRlcigi
TG9jYXRpb246ICIuJHJlZGlyZWN0WydyZWRpcmVjdFVybCddLCBUUlVFLCAzMDEpOwoKCQkg
IC8vIEluIGNhc2UgdGhlIGhlYWRlcigpIG1ldGhvZCBmYWlscywgZmFsbCBiYWNrIG9uIGEg
Y2xhc3NpYyByZWRpcmVjdAoJCSAgZWNobyAnPGh0bWw+PGhlYWQ+PE1FVEEgSFRUUC1FUVVJ
Vj0iUmVmcmVzaCIgQ09OVEVOVD0iMDtVUkw9JwoJCSAgICAuJHBlcm1saW5rLiciPjwvaGVh
ZD48Ym9keT48L2JvZHk+PC9odG1sPic7CgkJICBkaWUoKTsKCSAgfQoKfQoKZnVuY3Rpb24g
YXJjX3JlZGlyZWN0X3RhYigkZXZlbnQsICRzdGVwKSB7CiAgc3dpdGNoICgkc3RlcCkgewog
ICAgY2FzZSAnYWRkJzogYXJjX3JlZGlyZWN0X2FkZCgpOyBicmVhazsKICAgIGNhc2UgJ3Nh
dmUnOiBhcmNfcmVkaXJlY3Rfc2F2ZSgpOyBicmVhazsKICAgIGNhc2UgJ2VkaXQnOiBhcmNf
cmVkaXJlY3RfZWRpdCgpOyBicmVhazsKICAgIGNhc2UgJ2FyY19yZWRpcmVjdF9tdWx0aV9l
ZGl0JzogYXJjX3JlZGlyZWN0X211bHRpZWRpdCgpOyBicmVhazsKICAgIGNhc2UgJ2FyY19y
ZWRpcmVjdF9jaGFuZ2VfcGFnZWJ5JzogZXZlbnRfY2hhbmdlX3BhZ2VieSgnYXJjX3JlZGly
ZWN0Jyk7CiAgICBkZWZhdWx0OiBhcmNfcmVkaXJlY3RfbGlzdCgpOwogIH0KfQoKZnVuY3Rp
b24gYXJjX3JlZGlyZWN0X2xpc3QoJG1lc3NhZ2UgPSAnJykgewoKICBnbG9iYWwgJGV2ZW50
OwoKICBleHRyYWN0KGdwc2EoYXJyYXkoJ3BhZ2UnKSkpOwoKICBwYWdldG9wKCdhcmNfcmVk
aXJlY3QnLCRtZXNzYWdlKTsKCiAgJGNyaXRlcmlhID0gMTsKCiAgJHRvdGFsID0gZ2V0Q291
bnQoJ2FyY19yZWRpcmVjdCcsICRjcml0ZXJpYSk7CgogICRsaW1pdCA9IDI1OwogIGxpc3Qo
JHBhZ2UsICRvZmZzZXQsICRudW1QYWdlcykgPSBwYWdlcigkdG90YWwsICRsaW1pdCwgJHBh
Z2UpOwoKICAkc29ydF9zcWwgPSAnYXJjX3JlZGlyZWN0SUQgZGVzYyc7CgogICRycyA9IHNh
ZmVfcm93c19zdGFydCgnKicsICdhcmNfcmVkaXJlY3QnLCAiJGNyaXRlcmlhIG9yZGVyIGJ5
ICRzb3J0X3NxbCBsaW1pdCAkb2Zmc2V0LCAkbGltaXQiKTsKCgogIC8vIEluY2x1ZGUgYSBx
dWljayBhZGQgZm9ybQogICRodG1sID0gZm9ybSgKICAgIHN0YXJ0VGFibGUoJ2VkaXQnKQog
ICAgICAudHIoCiAgICAgICAgdGRhKHRhZygnT3JpZ2luYWwgVVJMJywnbGFiZWwnLCAnIGZv
cj0ib3JpZ2luYWxVcmwiJyksJyBzdHlsZT0idmVydGljYWwtYWxpZ246bWlkZGxlIicpCiAg
ICAgICAgLnRkKGZJbnB1dCgndGV4dCcsJ29yaWdpbmFsVXJsJywnJywnZWRpdCcsJycsJycs
JycsJycsJ29yaWdpbmFsVXJsJykpCiAgICAgICkudHIoCiAgICAgICAgdGRhKHRhZygnUmVk
aXJlY3QgVVJMJywnbGFiZWwnLCAnIGZvcj0icmVkaXJlY3RVcmwiJyksJyBzdHlsZT0idmVy
dGljYWwtYWxpZ246bWlkZGxlIicpCiAgICAgICAgLnRkKGZJbnB1dCgndGV4dCcsJ3JlZGly
ZWN0VXJsJywnJywnZWRpdCcsJycsJycsJycsJycsJ3JlZGlyZWN0VXJsJykKICAgICAgICAu
ZUlucHV0KCdhcmNfcmVkaXJlY3QnKQogICAgICAgIC5zSW5wdXQoJ2FkZCcpLicmbmJzcDsn
LmZJbnB1dCgnc3VibWl0JywnYWRkJyxnVHh0KCdBZGQnKSwncHVibGlzaCcpCiAgICAgICAg
KQogICAgICApCiAgICAuZW5kVGFibGUoKQogICwgJ21hcmdpbi1ib3R0b206MjVweCcpOwoK
ICAvLyBBZGQgYSBsaXN0IG9mIGV4aXN0aW5nIHJlZGlyZWN0cwogICRodG1sIC49IG4ubi4n
PGZvcm0gYWN0aW9uPSJpbmRleC5waHAiIGlkPSJhcmNfcmVkaXJlY3RfZm9ybSIgbWV0aG9k
PSJwb3N0IiBuYW1lPSJsb25nZm9ybSIgb25zdWJtaXQ9InJldHVybiB2ZXJpZnkoXCcnLmdU
eHQoJ2FyZV95b3Vfc3VyZScpLidcJykiPic7CiAgJGh0bWwgLj0gc3RhcnRUYWJsZSgnbGlz
dCcpOwoKICAkaHRtbCAuPSB0cigKICAgIGhDZWxsKCdJRCMnKQogICAgLmhDZWxsKCkKICAg
IC5oQ2VsbCgnT3JpZ2luYWwgVVJMJykKICAgIC5oQ2VsbCgnUmVkaXJlY3QgVVJMJykKICAg
IC5oQ2VsbCgpCiAgKTsKCiAgd2hpbGUgKCRyZWRpcmVjdCA9IG5leHRSb3coJHJzKSkgewog
ICAgJGVkaXRMaW5rID0gaHJlZihnVHh0KCdlZGl0JyksCiAgICAgICc/ZXZlbnQ9YXJjX3Jl
ZGlyZWN0JmFtcDtzdGVwPWVkaXQmYW1wO2lkPScuJHJlZGlyZWN0WydhcmNfcmVkaXJlY3RJ
RCddKTsKICAgICRyZWRpcmVjdExpbmsgPSBocmVmKCdUZXN0JywkcmVkaXJlY3RbJ29yaWdp
bmFsVXJsJ10pOwogICAgJGh0bWwgLj0gdHIoCiAgICAgIHRkKCRyZWRpcmVjdFsnYXJjX3Jl
ZGlyZWN0SUQnXSwgMjAsICdpZCcpCiAgICAgIC50ZCgiPHVsPjxsaSBjbGFzcz0nYWN0aW9u
LWVkaXQnPiRlZGl0TGluazwvbGk+PGxpIGNsYXNzPSdhY3Rpb24tdmlldyc+JHJlZGlyZWN0
TGluazwvbGk+PC91bD4iLCAzNSwgJ2FjdGlvbnMnKQogICAgICAudGQoJHJlZGlyZWN0Wydv
cmlnaW5hbFVybCddLCAxNzUpCiAgICAgIC50ZCgkcmVkaXJlY3RbJ3JlZGlyZWN0VXJsJ10s
IDE3NSkKICAgICAgLnRkKGZJbnB1dCgnY2hlY2tib3gnLCAnc2VsZWN0ZWRbXScsICRyZWRp
cmVjdFsnYXJjX3JlZGlyZWN0SUQnXSksICcnLCAnbXVsdGktZWRpdCcpCiAgICApOwogIH0K
CiAgJGh0bWwgLj0gbi4nPHRmb290PicudHIoCiAgICAgIHRkYShzZWxlY3RfYnV0dG9ucygp
CiAgICAgIC5ldmVudF9tdWx0aWVkaXRfZm9ybSgnYXJjX3JlZGlyZWN0JywgYXJyYXkoJ2Rl
bGV0ZSc9PmdUeHQoJ2RlbGV0ZScpKSwxLCcnLCcnLCcnLCcnKSwKICAgICAgJyBjbGFzcz0i
bXVsdGktZWRpdCIgY29sc3Bhbj0iNSIgc3R5bGU9InRleHQtYWxpZ246cmlnaHQ7Ym9yZGVy
Om5vbmUiJykKICAgICkubi4nPC90Zm9vdD4nOwoKICAkaHRtbCAuPSBlbmRUYWJsZSgpOwog
ICRodG1sIC49ICc8L2Zvcm0+JzsKCiAgJGh0bWwgLj0gbi4nPGRpdiBpZD0iJy4kZXZlbnQu
J19uYXZpZ2F0aW9uIiBjbGFzcz0idHhwLW5hdmlnYXRpb24iPicKICAgIC5uLm5hdl9mb3Jt
KCdhcmNfcmVkaXJlY3QnLCAkcGFnZSwgJG51bVBhZ2VzLCAnJywgJycsICcnLCAnJywgJHRv
dGFsLCAkbGltaXQpCiAgICAubi4nPC9kaXY+JzsKCiAgZWNobyAkaHRtbDsKCn0KCmZ1bmN0
aW9uIGFyY19yZWRpcmVjdF9lZGl0KCRtZXNzYWdlPScnKSB7CiAgcGFnZXRvcCgnYXJjX3Jl
ZGlyZWN0JywkbWVzc2FnZSk7CgogICRvcmlnaW5hbFVybCA9IGdwcygnb3JpZ2luYWxVcmwn
KTsKICAkcmVkaXJlY3RVcmwgPSBncHMoJ3JlZGlyZWN0VXJsJyk7CgogIGlmICgkaWQ9Z3Bz
KCdpZCcpKSB7CiAgICAkcnMgPSBzYWZlX3Jvdygnb3JpZ2luYWxVcmwscmVkaXJlY3RVcmwn
LCAnYXJjX3JlZGlyZWN0JywgImFyY19yZWRpcmVjdElEID0gJGlkIik7CiAgICBleHRyYWN0
KCRycyk7CiAgfQoKICAkaHRtbCA9IGZvcm0oCiAgICBzdGFydFRhYmxlKCdlZGl0JykKICAg
ICAgLnRyKAogICAgICAgIHRkYSh0YWcoJ09yaWdpbmFsIFVSTCcsJ2xhYmVsJywgJyBmb3I9
Im9yaWdpbmFsVXJsIicpLCcgc3R5bGU9InZlcnRpY2FsLWFsaWduOm1pZGRsZSInKQogICAg
ICAgIC50ZChmSW5wdXQoJ3RleHQnLCdvcmlnaW5hbFVybCcsJG9yaWdpbmFsVXJsLCdlZGl0
JywnJywnJywnJywnJywnb3JpZ2luYWxVcmwnKSkKICAgICAgKS50cigKICAgICAgICB0ZGEo
dGFnKCdSZWRpcmVjdCBVUkwnLCdsYWJlbCcsICcgZm9yPSJyZWRpcmVjdFVybCInKSwnIHN0
eWxlPSJ2ZXJ0aWNhbC1hbGlnbjptaWRkbGUiJykKICAgICAgICAudGQoZklucHV0KCd0ZXh0
JywncmVkaXJlY3RVcmwnLCRyZWRpcmVjdFVybCwnZWRpdCcsJycsJycsJycsJycsJ3JlZGly
ZWN0VXJsJykKICAgICAgICAuZUlucHV0KCdhcmNfcmVkaXJlY3QnKS4nJm5ic3A7JwogICAg
ICAgIC4oKCRpZCk/CiAgICAgICAgc0lucHV0KCdzYXZlJykuaElucHV0KCdpZCcsJGlkKS5m
SW5wdXQoJ3N1Ym1pdCcsJ3NhdmUnLGdUeHQoJ1NhdmUnKSwncHVibGlzaCcpCiAgICAgICAg
ICA6c0lucHV0KCdhZGQnKS5mSW5wdXQoJ3N1Ym1pdCcsJ2FkZCcsZ1R4dCgnQWRkJyksJ3B1
Ymxpc2gnKQogICAgICAgICkpCiAgICAgICkKICAgIC5lbmRUYWJsZSgpCiAgKTsKCiAgZWNo
byAkaHRtbDsKCn0KCmZ1bmN0aW9uIGFyY19yZWRpcmVjdF9hZGQoKSB7CiAgJG9yaWdpbmFs
VXJsID0gZ3BzKCdvcmlnaW5hbFVybCcpOwogICRyZWRpcmVjdFVybCA9IGdwcygncmVkaXJl
Y3RVcmwnKTsKCiAgaWYgKCRvcmlnaW5hbFVybCA9PT0gJycgfHwgJHJlZGlyZWN0VXJsID09
PSAnJykgewogICAgYXJjX3JlZGlyZWN0X2VkaXQoJ1VuYWJsZSB0byBhZGQgbmV3IHJlZGly
ZWN0Jyk7CiAgICByZXR1cm47CiAgfQoKICAvLyBTdHJpcCBmaW5hbCBzbGFzaCBmcm9tIG9y
aWdpbmFsIHVybAogIGlmIChzdWJzdHIoJG9yaWdpbmFsVXJsLC0xKT09Jy8nKSB7CiAgICAk
b3JpZ2luYWxVcmwgPSBzdWJzdHIoJG9yaWdpbmFsVXJsLCAwLCAtMSk7CiAgfQoKICAkcSA9
IHNhZmVfaW5zZXJ0KCJhcmNfcmVkaXJlY3QiLAogICAgIm9yaWdpbmFsVXJsID0gJyIudHJp
bSgkb3JpZ2luYWxVcmwpLiInLCByZWRpcmVjdFVybCA9ICciLnRyaW0oJHJlZGlyZWN0VXJs
KS4iJyIKICApOwoKICAkR0xPQkFMU1snSUQnXSA9IG15c3FsX2luc2VydF9pZCgpOwoKICBp
ZiAoJHEpIHsKICAgICRtZXNzYWdlID0gZ1R4dCgnUmVkaXJlY3QgYWRkZWQnKTsKICAgIGFy
Y19yZWRpcmVjdF9saXN0KCRtZXNzYWdlKTsKICB9Cn0KCmZ1bmN0aW9uIGFyY19yZWRpcmVj
dF9zYXZlKCkgewoKICBpZiAoISRpZD1ncHMoJ2lkJykpIHsKICAgIGFyY19yZWRpcmVjdF9s
aXN0KCdVbmFibGUgdG8gc2F2ZSByZWRpcmVjdCcpOwogICAgcmV0dXJuOwogIH0KCiAgJG9y
aWdpbmFsVXJsID0gZ3BzKCdvcmlnaW5hbFVybCcpOwogICRyZWRpcmVjdFVybCA9IGdwcygn
cmVkaXJlY3RVcmwnKTsKCiAgaWYgKCRvcmlnaW5hbFVybCA9PSAnJyB8fCAkcmVkaXJlY3RV
cmwgPT0gJycpIHsKICAgIGFyY19yZWRpcmVjdF9lZGl0KCdVbmFibGUgdG8gc2F2ZSByZWRp
cmVjdCcpOwogICAgcmV0dXJuOwogIH0KCiAgLy8gU3RyaXAgZmluYWwgc2xhc2ggZnJvbSBv
cmlnaW5hbCB1cmwKICBpZiAoc3Vic3RyKCRvcmlnaW5hbFVybCwtMSk9PScvJykgewogICAg
JG9yaWdpbmFsVXJsID0gc3Vic3RyKCRvcmlnaW5hbFVybCwgMCwgLTEpOwogIH0KCiAgJHJz
ID0gc2FmZV91cGRhdGUoImFyY19yZWRpcmVjdCIsCiAgICAib3JpZ2luYWxVcmwgICAgPSAn
Ii50cmltKCRvcmlnaW5hbFVybCkuIicsICByZWRpcmVjdFVybCA9ICciLnRyaW0oJHJlZGly
ZWN0VXJsKS4iJyIsCiAgICAiYXJjX3JlZGlyZWN0SUQgPSAkaWQiCiAgKTsKCiAgaWYgKCRy
cykgewogICAgJG1lc3NhZ2UgPSBnVHh0KCdSZWRpcmVjdCB1cGRhdGVkJyk7CiAgICBhcmNf
cmVkaXJlY3RfbGlzdCgkbWVzc2FnZSk7CiAgfQp9CgpmdW5jdGlvbiBhcmNfcmVkaXJlY3Rf
bXVsdGllZGl0KCkgewogICRzZWxlY3RlZCA9IHBzKCdzZWxlY3RlZCcpOwoKICBpZiAoISRz
ZWxlY3RlZCB8fCAhaXNfYXJyYXkoJHNlbGVjdGVkKSkgewogICAgYXJjX3JlZGlyZWN0X2xp
c3QoKTsKICAgIHJldHVybjsKICB9CgogICRtZXRob2QgPSBwcygnZWRpdF9tZXRob2QnKTsK
ICAkY2hhbmdlZCA9IGFycmF5KCk7CgogICRtZXNzYWdlID0gJyc7CgogIHN3aXRjaCAoJG1l
dGhvZCkgewogICAgY2FzZSAnZGVsZXRlJzoKCiAgICAgIGZvcmVhY2ggKCRzZWxlY3RlZCBh
cyAkaWQpIHsKICAgICAgICBpZiAoc2FmZV9kZWxldGUoJ2FyY19yZWRpcmVjdCcsICdhcmNf
cmVkaXJlY3RJRCA9ICcuJGlkKSkgewogICAgICAgICAgJGNoYW5nZWRbXSA9ICRpZDsKICAg
ICAgICB9CiAgICAgIH0KICAgICAgJG1lc3NhZ2UgPSBjb3VudCgkY2hhbmdlZCkuJyByZWRp
cmVjdHMgZGVsZXRlZCc7CiAgICAgIGJyZWFrOwogIH0KCiAgYXJjX3JlZGlyZWN0X2xpc3Qo
JG1lc3NhZ2UpOwp9CgovLyBJbnN0YWxsYXRpb24gZnVuY3Rpb24gLSBidWlsZHMgTXlTUUwg
dGFibGUKZnVuY3Rpb24gYXJjX3JlZGlyZWN0X2luc3RhbGwoKQp7CgogIC8vIEZvciBmaXJz
dCBpbnN0YWxsLCBjcmVhdGUgdGFibGUgZm9yIHR3ZWV0cwogICRzcWwgPSAiQ1JFQVRFIFRB
QkxFIElGIE5PVCBFWElTVFMgIi5QRlguImFyY19yZWRpcmVjdCAiOwogICRzcWwuPSAiKGFy
Y19yZWRpcmVjdElEIElOVEVHRVIgQVVUT19JTkNSRU1FTlQgUFJJTUFSWSBLRVksCiAgICBv
cmlnaW5hbFVybCBWQVJDSEFSKDI0MCksCiAgICByZWRpcmVjdFVybCBWQVJDSEFSKDI0MCkp
OyI7CgogIGlmICghc2FmZV9xdWVyeSgkc3FsKSkgewogICAgcmV0dXJuICdFcnJvciAtIHVu
YWJsZSB0byBjcmVhdGUgYXJjX3JlZGlyZWN0IHRhYmxlJzsKICB9Cgp9CgovLyBVbmluc3Rh
bGwgZnVuY3Rpb24gLSBkZWxldGVzIE15U1FMIHRhYmxlIGFuZCByZWxhdGVkIHByZWZlcmVu
Y2VzCgpmdW5jdGlvbiBhcmNfcmVkaXJlY3RfdW5pbnN0YWxsKCkKewogICRzcWwgPSAiRFJP
UCBUQUJMRSBJRiBFWElTVFMgIi5QRlguImFyY19yZWRpcmVjdDsiOwogIGlmICghc2FmZV9x
dWVyeSgkc3FsKSkgewogICAgcmV0dXJuICdFcnJvciAtIHVuYWJsZSB0byBkZWxldGUgYXJj
X3JlZGlyZWN0IHRhYmxlJzsKICB9Cn0iO3M6MzoibWQ1IjtzOjMyOiIwYzU1OGY4NDUwMzdh
ZjRhZWUyZDM3ZTFiY2E3YTRjMyI7fQ==
