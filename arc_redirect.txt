# arc_redirect v1.0beta
# Love redirects, hate 404s
# Andy Carter
# http://redhotchilliproject.com/

# ......................................................................
# This is a plugin for Textpattern - http://textpattern.com/
# To install: textpattern > admin > plugins
# Paste the following text into the 'Install plugin' box:
# ......................................................................

YToxMTp7czo0OiJuYW1lIjtzOjEyOiJhcmNfcmVkaXJlY3QiO3M6NzoidmVyc2lvbiI7czo3
OiIxLjBiZXRhIjtzOjY6ImF1dGhvciI7czoxMToiQW5keSBDYXJ0ZXIiO3M6MTA6ImF1dGhv
cl91cmkiO3M6MzE6Imh0dHA6Ly9yZWRob3RjaGlsbGlwcm9qZWN0LmNvbS8iO3M6MTE6ImRl
c2NyaXB0aW9uIjtzOjI1OiJMb3ZlIHJlZGlyZWN0cywgaGF0ZSA0MDRzIjtzOjU6Im9yZGVy
IjtzOjE6IjUiO3M6NDoidHlwZSI7czoxOiIxIjtzOjU6ImZsYWdzIjtzOjE6IjIiO3M6NDoi
aGVscCI7czoyMTYzOiIJPGgxIGNsYXNzPSJ0aXRsZSI+YXJjX3JlZGlyZWN0IChsb3ZlIHJl
ZGlyZWN0cywgaGF0ZSA0MDRzKTwvaDE+CgoJPHA+SWYgeW91JiM4MjE3O3JlIGluIHRoZSBw
cm9jZXNzIG9mIHJlc3RydWN0dXJpbmcgYSBUZXh0cGF0dGVybiBzaXRlLCB0aGVuIHRoaXMg
aXMgdGhlIHBsdWdpbiBmb3IgeW91ITwvcD4KCgk8cD5SZXF1aXJlbWVudHM6LTwvcD4KCgk8
dWw+CgkJPGxpPlRleHRwYXR0ZXJuIDQuMis8L2xpPgoJPC91bD4KCgk8aDIgY2xhc3M9InNl
Y3Rpb24iPkF1dGhvcjwvaDI+CgoJPHA+PGEgaHJlZj0iaHR0cDovL3JlZGhvdGNoaWxsaXBy
b2plY3QuY29tIj5BbmR5IENhcnRlcjwvYT4uIEZvciBvdGhlciBUZXh0cGF0dGVybiBwbHVn
aW5zIGJ5IG1lIHZpc2l0IG15IDxhIGhyZWY9Imh0dHA6Ly9yZWRob3RjaGlsbGlwcm9qZWN0
LmNvbS90eHAiPlBsdWdpbnMgcGFnZTwvYT4uPC9wPgoKCTxwPlRoYW5rcyB0byA8YSBocmVm
PSJodHRwOi8vb2xpdmVya2VyLmNvLnVrLyI+T2xpdmVyIEtlcjwvYT4gZm9yIGdpdmluZyBt
ZSB0aGUgaWRlYSBmb3IgdGhpcyBwbHVnaW4uPC9wPgoKCTxoMiBjbGFzcz0ic2VjdGlvbiI+
SW5zdGFsbGF0aW9uIC8gVW5pbnN0YWxsYXRpb248L2gyPgoKCTxwPlRvIGluc3RhbGwgZ28g
dG8gdGhlICYjODIxNjtwbHVnaW5zJiM4MjE3OyB0YWIgdW5kZXIgJiM4MjE2O2FkbWluJiM4
MjE3OyBhbmQgcGFzdGUgdGhlIHBsdWdpbiBjb2RlIGludG8gdGhlICYjODIxNjtJbnN0YWxs
IHBsdWdpbiYjODIxNzsgYm94LCAmIzgyMTY7dXBsb2FkJiM4MjE3OyBhbmQgdGhlbiAmIzgy
MTY7aW5zdGFsbCYjODIxNzsuIEZpbmFsbHkgYWN0aXZhdGUgdGhlIHBsdWdpbi48L3A+CgoJ
PHA+VG8gdW5pbnN0YWxsIDxzcGFuIGNsYXNzPSJ0YWciPmFyY19yZWRpcmVjdDwvc3Bhbj4g
c2ltcGx5IGRlbGV0ZSB0aGUgcGx1Z2luIGZyb20gdGhlICYjODIxNjtQbHVnaW5zJiM4MjE3
OyB0YWIuICBUaGlzIHdpbGwgcmVtb3ZlIHRoZSBwbHVnaW4gY29kZSBhbmQgZHJvcCB0aGUg
PHNwYW4gY2xhc3M9InRhZyI+YXJjX3JlZGlyZWN0PC9zcGFuPiB0YWJsZSBmcm9tIHlvdXIg
VGV4dHBhdHRlcm4gZGF0YWJhc2UuPC9wPgoKCTxoMiBjbGFzcz0ic2VjdGlvbiI+VXNhZ2U8
L2gyPgoKCTxwPjxzcGFuIGNsYXNzPSJ0YWciPmFyY19yZWRpcmVjdDwvc3Bhbj4gYWRkcyBh
IG5ldyB0YWIgdW5kZXIgJiM4MjE2O0V4dGVuc2lvbnMmIzgyMTc7IGZyb20gd2hlcmUgeW91
IGNhbiBkZWZpbmUgcGFpcnMgb2YgPHNwYW4gY2xhc3M9ImNhcHMiPlVSTDwvc3Bhbj5zIGZv
ciBoYW5kbGluZyByZWRpcmVjdHMuIEJhc2ljYWxseSBwcm92aWRlIGFuIG9yaWdpbmFsIDxz
cGFuIGNsYXNzPSJjYXBzIj5VUkw8L3NwYW4+IG9uIHlvdXIgVGV4dHBhdHRlcm4gc2l0ZSB0
aGF0IGlzIGdlbmVyYXRpbmcgYSA0MDQsICYjODIyMDtwYWdlIG5vdCBmb3VuZCYjODIyMTss
IGVycm9yIGFuZCBhIHJlZGlyZWN0IDxzcGFuIGNsYXNzPSJjYXBzIj5VUkw8L3NwYW4+LiBU
aGVuIHdoZW5ldmVyIHNvbWVvbmUgZ29lcyB0byB0aGUgb3JpZ2luYWwgPHNwYW4gY2xhc3M9
ImNhcHMiPlVSTDwvc3Bhbj4gcmF0aGVyIHRoYW4gZ2V0IHRoZSBzdGFuZGFyZCA0MDQgZXJy
b3IgcGFnZSB0aGV5IHdpbGwgYmUgcmVkaXJjdGVkIHRvIHRoZSBuZXcgPHNwYW4gY2xhc3M9
ImNhcHMiPlVSTDwvc3Bhbj4gKHdpdGggYSAzMDEgcGVybWVuYW50ZWx5IG1vdmVkKS48L3A+
CgoJPHA+VGhlIHJlZGlyZWN0IGZyb20gPHNwYW4gY2xhc3M9ImNhcHMiPlVSTDwvc3Bhbj4g
bXVzdCBwcm9kdWNlIGEgNDA0IHBhZ2UgaW4gVGV4dHBhdHRlcm4gb24gdGhlIHNpdGUgdGhp
cyBwbHVnaW4gaXMgaW5zdGFsbGVkLjwvcD4KCgk8dWw+CgkJPGxpPjxzcGFuIGNsYXNzPSJ0
YWciPmFyY19yZWRpcmVjdDwvc3Bhbj4gdHJlYXRzIGh0dHA6Ly93d3cuZXhhbXBsZS5jb20v
bWlzc2luZyB0aGUgc2FtZSBhcyBodHRwOi8vd3d3LmV4YW1wbGUuY29tL21pc3NpbmcvPC9s
aT4KCQk8bGk+PHNwYW4gY2xhc3M9InRhZyI+YXJjX3JlZGlyZWN0PC9zcGFuPiBkb2VzIG5v
dCB0cmVhdCBodHRwOi8vZXhhbXBsZS5jb20vbWlzc2luZyBhbmQgaHR0cDovL3d3dy5leGFt
cGxlLmNvbS9taXNzaW5nIGFzIHRoZSBzYW1lIDxzcGFuIGNsYXNzPSJjYXBzIj5VUkw8L3Nw
YW4+PC9saT4KCTwvdWw+CgoiO3M6NDoiY29kZSI7czo3NDc2OiJyZWdpc3Rlcl9jYWxsYmFj
aygnYXJjX3JlZGlyZWN0X2luc3RhbGwnLCdwbHVnaW5fbGlmZWN5Y2xlLmFyY19yZWRpcmVj
dCcsICdpbnN0YWxsZWQnKTsKcmVnaXN0ZXJfY2FsbGJhY2soJ2FyY19yZWRpcmVjdF91bmlu
c3RhbGwnLCdwbHVnaW5fbGlmZWN5Y2xlLmFyY19yZWRpcmVjdCcsICdkZWxldGVkJyk7CnJl
Z2lzdGVyX2NhbGxiYWNrKCdhcmNfcmVkaXJlY3QnLCAndHhwX2RpZScsIDQwNCk7CmFkZF9w
cml2cygnYXJjX3JlZGlyZWN0JywgJzEsMiwzLDQnKTsKcmVnaXN0ZXJfdGFiKCdleHRlbnNp
b25zJywgJ2FyY19yZWRpcmVjdCcsICdhcmNfcmVkaXJlY3QnKTsKcmVnaXN0ZXJfY2FsbGJh
Y2soJ2FyY19yZWRpcmVjdF90YWInLCAnYXJjX3JlZGlyZWN0Jyk7CgovKgogKiBDaGVjayBm
b3IgcmVkaXJlY3RlZCBVUkxzIGFuZCBmb3J3YXJkIHdpdGggYSAzMDEgd2hlcmUgbmVjZXNz
YXJ5LgogKi8KZnVuY3Rpb24gYXJjX3JlZGlyZWN0KCRldmVudCwgJHN0ZXApIHsKICAkdXJs
ID0gUFJPVE9DT0wuJF9TRVJWRVJbJ1NFUlZFUl9OQU1FJ10uJF9TRVJWRVJbJ1JFUVVFU1Rf
VVJJJ107CgogIC8vIFN0cmlwIGZpbmFsIHNsYXNoIGZyb20gdXJsCiAgaWYgKHN1YnN0cigk
dXJsLC0xKT09Jy8nKSB7ICR1cmwgPSBzdWJzdHIoJHVybCwgMCwgLTEpOyB9CgogICRzcWwg
PSAiU0VMRUNUIHJlZGlyZWN0VXJsIEZST00gIi5QRlguImFyY19yZWRpcmVjdCBXSEVSRSBv
cmlnaW5hbFVybCA9ICciLiR1cmwuIic7IjsKICAkcnMgPSBzYWZlX3F1ZXJ5KCRzcWwpOyAk
cmVkaXJlY3QgPSBuZXh0Um93KCRycyk7CgoJICBpZiAoJHJlZGlyZWN0WydyZWRpcmVjdFVy
bCddKSB7CgkJICBvYl9lbmRfY2xlYW4oKTsKCgkJICBoZWFkZXIoIlN0YXR1czogMzAxIik7
CgkJICBoZWFkZXIoIkhUVFAvMS4wIDMwMSBNb3ZlZCBQZXJtYW5lbnRseSIpOwoJCSAgaGVh
ZGVyKCJMb2NhdGlvbjogIi4kcmVkaXJlY3RbJ3JlZGlyZWN0VXJsJ10sIFRSVUUsIDMwMSk7
CgoJCSAgLy8gSW4gY2FzZSB0aGUgaGVhZGVyKCkgbWV0aG9kIGZhaWxzLCBmYWxsIGJhY2sg
b24gYSBjbGFzc2ljIHJlZGlyZWN0CgkJICBlY2hvICc8aHRtbD48aGVhZD48TUVUQSBIVFRQ
LUVRVUlWPSJSZWZyZXNoIiBDT05URU5UPSIwO1VSTD0nCgkJICAgIC4kcGVybWxpbmsuJyI+
PC9oZWFkPjxib2R5PjwvYm9keT48L2h0bWw+JzsKCQkgIGRpZSgpOwoJICB9Cgp9CgpmdW5j
dGlvbiBhcmNfcmVkaXJlY3RfdGFiKCRldmVudCwgJHN0ZXApIHsKICBzd2l0Y2ggKCRzdGVw
KSB7CiAgICBjYXNlICdhZGQnOiBhcmNfcmVkaXJlY3RfYWRkKCk7IGJyZWFrOwogICAgY2Fz
ZSAnc2F2ZSc6IGFyY19yZWRpcmVjdF9zYXZlKCk7IGJyZWFrOwogICAgY2FzZSAnZWRpdCc6
IGFyY19yZWRpcmVjdF9lZGl0KCk7IGJyZWFrOwogICAgY2FzZSAnYXJjX3JlZGlyZWN0X211
bHRpX2VkaXQnOiBhcmNfcmVkaXJlY3RfbXVsdGllZGl0KCk7IGJyZWFrOwogICAgZGVmYXVs
dDogYXJjX3JlZGlyZWN0X2xpc3QoKTsKICB9Cn0KCmZ1bmN0aW9uIGFyY19yZWRpcmVjdF9s
aXN0KCRtZXNzYWdlID0gJycpIHsKCiAgZ2xvYmFsICRldmVudDsKCiAgZXh0cmFjdChncHNh
KGFycmF5KCdwYWdlJykpKTsKCiAgcGFnZXRvcCgnYXJjX3JlZGlyZWN0JywkbWVzc2FnZSk7
CgogICRjcml0ZXJpYSA9IDE7CgogICR0b3RhbCA9IGdldENvdW50KCdhcmNfcmVkaXJlY3Qn
LCAkY3JpdGVyaWEpOwoKICAkbGltaXQgPSAyNTsKICBsaXN0KCRwYWdlLCAkb2Zmc2V0LCAk
bnVtUGFnZXMpID0gcGFnZXIoJHRvdGFsLCAkbGltaXQsICRwYWdlKTsKCiAgJHNvcnRfc3Fs
ID0gJ2FyY19yZWRpcmVjdElEIGRlc2MnOwoKICAkcnMgPSBzYWZlX3Jvd3Nfc3RhcnQoJyon
LCAnYXJjX3JlZGlyZWN0JywgIiRjcml0ZXJpYSBvcmRlciBieSAkc29ydF9zcWwgbGltaXQg
JG9mZnNldCwgJGxpbWl0Iik7CgoKICAvLyBJbmNsdWRlIGEgcXVpY2sgYWRkIGZvcm0KICAk
aHRtbCA9IGZvcm0oCiAgICBzdGFydFRhYmxlKCdlZGl0JykKICAgICAgLnRyKAogICAgICAg
IHRkYSh0YWcoJ1JlZGlyZWN0IGZyb20gVVJMIChwcm9kdWNlcyA0MDQgcGFnZSknLCdsYWJl
bCcsICcgZm9yPSJvcmlnaW5hbFVybCInKSwnIHN0eWxlPSJ2ZXJ0aWNhbC1hbGlnbjptaWRk
bGUiJykKICAgICAgICAudGQoZklucHV0KCd0ZXh0Jywnb3JpZ2luYWxVcmwnLCcnLCdlZGl0
JywnJywnJywnJywnJywnb3JpZ2luYWxVcmwnKSkKICAgICAgKS50cigKICAgICAgICB0ZGEo
dGFnKCdSZWRpcmVjdCB0byBVUkwnLCdsYWJlbCcsICcgZm9yPSJyZWRpcmVjdFVybCInKSwn
IHN0eWxlPSJ2ZXJ0aWNhbC1hbGlnbjptaWRkbGUiJykKICAgICAgICAudGQoZklucHV0KCd0
ZXh0JywncmVkaXJlY3RVcmwnLCcnLCdlZGl0JywnJywnJywnJywnJywncmVkaXJlY3RVcmwn
KQogICAgICAgIC5lSW5wdXQoJ2FyY19yZWRpcmVjdCcpCiAgICAgICAgLnNJbnB1dCgnYWRk
JykuJyZuYnNwOycuZklucHV0KCdzdWJtaXQnLCdhZGQnLGdUeHQoJ0FkZCcpLCdwdWJsaXNo
JykKICAgICAgICApCiAgICAgICkKICAgIC5lbmRUYWJsZSgpCiAgLCAnbWFyZ2luLWJvdHRv
bToyNXB4Jyk7CgogIC8vIEFkZCBhIGxpc3Qgb2YgZXhpc3RpbmcgcmVkaXJlY3RzCiAgJGh0
bWwgLj0gbi5uLic8Zm9ybSBhY3Rpb249ImluZGV4LnBocCIgaWQ9ImFyY19yZWRpcmVjdF9m
b3JtIiBtZXRob2Q9InBvc3QiIG5hbWU9Imxvbmdmb3JtIiBvbnN1Ym1pdD0icmV0dXJuIHZl
cmlmeShcJycuZ1R4dCgnYXJlX3lvdV9zdXJlJykuJ1wnKSI+JzsKICAkaHRtbCAuPSBzdGFy
dFRhYmxlKCdsaXN0Jyk7CgogICRodG1sIC49IHRyKAogICAgaENlbGwoJ0lEIycpCiAgICAu
aENlbGwoKQogICAgLmhDZWxsKCdPcmlnaW5hbCBVUkwnKQogICAgLmhDZWxsKCdSZWRpcmVj
dCBVUkwnKQogICAgLmhDZWxsKCkKICApOwoKICB3aGlsZSAoJHJlZGlyZWN0ID0gbmV4dFJv
dygkcnMpKSB7CiAgICAkZWRpdExpbmsgPSBocmVmKGdUeHQoJ2VkaXQnKSwKICAgICAgJz9l
dmVudD1hcmNfcmVkaXJlY3QmYW1wO3N0ZXA9ZWRpdCZhbXA7aWQ9Jy4kcmVkaXJlY3RbJ2Fy
Y19yZWRpcmVjdElEJ10pOwogICAgJHJlZGlyZWN0TGluayA9IGhyZWYoJ1Rlc3QnLCRyZWRp
cmVjdFsnb3JpZ2luYWxVcmwnXSk7CiAgICAkaHRtbCAuPSB0cigKICAgICAgdGQoJHJlZGly
ZWN0WydhcmNfcmVkaXJlY3RJRCddLCAyMCwgJ2lkJykKICAgICAgLnRkKCI8dWw+PGxpIGNs
YXNzPSdhY3Rpb24tZWRpdCc+JGVkaXRMaW5rPC9saT48bGkgY2xhc3M9J2FjdGlvbi12aWV3
Jz4kcmVkaXJlY3RMaW5rPC9saT48L3VsPiIsIDM1LCAnYWN0aW9ucycpCiAgICAgIC50ZCgk
cmVkaXJlY3RbJ29yaWdpbmFsVXJsJ10sIDE3NSkKICAgICAgLnRkKCRyZWRpcmVjdFsncmVk
aXJlY3RVcmwnXSwgMTc1KQogICAgICAudGQoZklucHV0KCdjaGVja2JveCcsICdzZWxlY3Rl
ZFtdJywgJHJlZGlyZWN0WydhcmNfcmVkaXJlY3RJRCddKSwgJycsICdtdWx0aS1lZGl0JykK
ICAgICk7CiAgfQoKICAkaHRtbCAuPSBuLic8dGZvb3Q+Jy50cigKICAgICAgdGRhKHNlbGVj
dF9idXR0b25zKCkKICAgICAgLmV2ZW50X211bHRpZWRpdF9mb3JtKCdhcmNfcmVkaXJlY3Qn
LCBhcnJheSgnZGVsZXRlJz0+Z1R4dCgnZGVsZXRlJykpLDEsJycsJycsJycsJycpLAogICAg
ICAnIGNsYXNzPSJtdWx0aS1lZGl0IiBjb2xzcGFuPSI1IiBzdHlsZT0idGV4dC1hbGlnbjpy
aWdodDtib3JkZXI6bm9uZSInKQogICAgKS5uLic8L3Rmb290Pic7CgogICRodG1sIC49IGVu
ZFRhYmxlKCk7CiAgJGh0bWwgLj0gJzwvZm9ybT4nOwoKICAkaHRtbCAuPSBuLic8ZGl2IGlk
PSInLiRldmVudC4nX25hdmlnYXRpb24iIGNsYXNzPSJ0eHAtbmF2aWdhdGlvbiI+JwogICAg
Lm4ubmF2X2Zvcm0oJ2FyY19yZWRpcmVjdCcsICRwYWdlLCAkbnVtUGFnZXMsICcnLCAnJywg
JycsICcnLCAkdG90YWwsICRsaW1pdCkKICAgIC5uLic8L2Rpdj4nOwoKICBlY2hvICRodG1s
OwoKfQoKZnVuY3Rpb24gYXJjX3JlZGlyZWN0X2VkaXQoJG1lc3NhZ2U9JycpIHsKICBwYWdl
dG9wKCdhcmNfcmVkaXJlY3QnLCRtZXNzYWdlKTsKCiAgJG9yaWdpbmFsVXJsID0gZ3BzKCdv
cmlnaW5hbFVybCcpOwogICRyZWRpcmVjdFVybCA9IGdwcygncmVkaXJlY3RVcmwnKTsKCiAg
aWYgKCRpZD1ncHMoJ2lkJykpIHsKICAgICRycyA9IHNhZmVfcm93KCdvcmlnaW5hbFVybCxy
ZWRpcmVjdFVybCcsICdhcmNfcmVkaXJlY3QnLCAiYXJjX3JlZGlyZWN0SUQgPSAkaWQiKTsK
ICAgIGV4dHJhY3QoJHJzKTsKICB9CgogICRodG1sID0gZm9ybSgKICAgIHN0YXJ0VGFibGUo
J2VkaXQnKQogICAgICAudHIoCiAgICAgICAgdGRhKHRhZygnUmVkaXJlY3QgZnJvbSBVUkwg
KHByb2R1Y2VzIDQwNCBwYWdlKScsJ2xhYmVsJywgJyBmb3I9Im9yaWdpbmFsVXJsIicpLCcg
c3R5bGU9InZlcnRpY2FsLWFsaWduOm1pZGRsZSInKQogICAgICAgIC50ZChmSW5wdXQoJ3Rl
eHQnLCdvcmlnaW5hbFVybCcsJG9yaWdpbmFsVXJsLCdlZGl0JywnJywnJywnJywnJywnb3Jp
Z2luYWxVcmwnKSkKICAgICAgKS50cigKICAgICAgICB0ZGEodGFnKCdSZWRpcmVjdCB0byBV
UkwnLCdsYWJlbCcsICcgZm9yPSJyZWRpcmVjdFVybCInKSwnIHN0eWxlPSJ2ZXJ0aWNhbC1h
bGlnbjptaWRkbGUiJykKICAgICAgICAudGQoZklucHV0KCd0ZXh0JywncmVkaXJlY3RVcmwn
LCRyZWRpcmVjdFVybCwnZWRpdCcsJycsJycsJycsJycsJ3JlZGlyZWN0VXJsJykKICAgICAg
ICAuZUlucHV0KCdhcmNfcmVkaXJlY3QnKS4nJm5ic3A7JwogICAgICAgIC4oKCRpZCk/CiAg
ICAgICAgc0lucHV0KCdzYXZlJykuaElucHV0KCdpZCcsJGlkKS5mSW5wdXQoJ3N1Ym1pdCcs
J3NhdmUnLGdUeHQoJ1NhdmUnKSwncHVibGlzaCcpCiAgICAgICAgICA6c0lucHV0KCdhZGQn
KS5mSW5wdXQoJ3N1Ym1pdCcsJ2FkZCcsZ1R4dCgnQWRkJyksJ3B1Ymxpc2gnKQogICAgICAg
ICkpCiAgICAgICkKICAgIC5lbmRUYWJsZSgpCiAgKTsKCiAgZWNobyAkaHRtbDsKCn0KCmZ1
bmN0aW9uIGFyY19yZWRpcmVjdF9hZGQoKSB7CiAgJG9yaWdpbmFsVXJsID0gZ3BzKCdvcmln
aW5hbFVybCcpOwogICRyZWRpcmVjdFVybCA9IGdwcygncmVkaXJlY3RVcmwnKTsKCiAgaWYg
KCRvcmlnaW5hbFVybCA9PT0gJycgfHwgJHJlZGlyZWN0VXJsID09PSAnJykgewogICAgYXJj
X3JlZGlyZWN0X2VkaXQoJ1VuYWJsZSB0byBhZGQgbmV3IHJlZGlyZWN0Jyk7CiAgICByZXR1
cm47CiAgfQoKICAvLyBTdHJpcCBmaW5hbCBzbGFzaCBmcm9tIG9yaWdpbmFsIHVybAogIGlm
IChzdWJzdHIoJG9yaWdpbmFsVXJsLC0xKT09Jy8nKSB7CiAgICAkb3JpZ2luYWxVcmwgPSBz
dWJzdHIoJG9yaWdpbmFsVXJsLCAwLCAtMSk7CiAgfQoKICAkcSA9IHNhZmVfaW5zZXJ0KCJh
cmNfcmVkaXJlY3QiLAogICAgIm9yaWdpbmFsVXJsID0gJyIudHJpbSgkb3JpZ2luYWxVcmwp
LiInLCByZWRpcmVjdFVybCA9ICciLnRyaW0oJHJlZGlyZWN0VXJsKS4iJyIKICApOwoKICAk
R0xPQkFMU1snSUQnXSA9IG15c3FsX2luc2VydF9pZCgpOwoKICBpZiAoJHEpIHsKICAgICRt
ZXNzYWdlID0gZ1R4dCgnUmVkaXJlY3QgYWRkZWQnKTsKICAgIGFyY19yZWRpcmVjdF9saXN0
KCRtZXNzYWdlKTsKICB9Cn0KCmZ1bmN0aW9uIGFyY19yZWRpcmVjdF9zYXZlKCkgewoKICBp
ZiAoISRpZD1ncHMoJ2lkJykpIHsKICAgIGFyY19yZWRpcmVjdF9saXN0KCdVbmFibGUgdG8g
c2F2ZSByZWRpcmVjdCcpOwogICAgcmV0dXJuOwogIH0KCiAgJG9yaWdpbmFsVXJsID0gZ3Bz
KCdvcmlnaW5hbFVybCcpOwogICRyZWRpcmVjdFVybCA9IGdwcygncmVkaXJlY3RVcmwnKTsK
CiAgaWYgKCRvcmlnaW5hbFVybCA9PSAnJyB8fCAkcmVkaXJlY3RVcmwgPT0gJycpIHsKICAg
IGFyY19yZWRpcmVjdF9lZGl0KCdVbmFibGUgdG8gc2F2ZSByZWRpcmVjdCcpOwogICAgcmV0
dXJuOwogIH0KCiAgLy8gU3RyaXAgZmluYWwgc2xhc2ggZnJvbSBvcmlnaW5hbCB1cmwKICBp
ZiAoc3Vic3RyKCRvcmlnaW5hbFVybCwtMSk9PScvJykgewogICAgJG9yaWdpbmFsVXJsID0g
c3Vic3RyKCRvcmlnaW5hbFVybCwgMCwgLTEpOwogIH0KCiAgJHJzID0gc2FmZV91cGRhdGUo
ImFyY19yZWRpcmVjdCIsCiAgICAib3JpZ2luYWxVcmwgICAgPSAnIi50cmltKCRvcmlnaW5h
bFVybCkuIicsICByZWRpcmVjdFVybCA9ICciLnRyaW0oJHJlZGlyZWN0VXJsKS4iJyIsCiAg
ICAiYXJjX3JlZGlyZWN0SUQgPSAkaWQiCiAgKTsKCiAgaWYgKCRycykgewogICAgJG1lc3Nh
Z2UgPSBnVHh0KCdSZWRpcmVjdCB1cGRhdGVkJyk7CiAgICBhcmNfcmVkaXJlY3RfbGlzdCgk
bWVzc2FnZSk7CiAgfQp9CgpmdW5jdGlvbiBhcmNfcmVkaXJlY3RfbXVsdGllZGl0KCkgewog
ICRzZWxlY3RlZCA9IHBzKCdzZWxlY3RlZCcpOwoKICBpZiAoISRzZWxlY3RlZCB8fCAhaXNf
YXJyYXkoJHNlbGVjdGVkKSkgewogICAgYXJjX3JlZGlyZWN0X2xpc3QoKTsKICAgIHJldHVy
bjsKICB9CgogICRtZXRob2QgPSBwcygnZWRpdF9tZXRob2QnKTsKICAkY2hhbmdlZCA9IGFy
cmF5KCk7CgogICRtZXNzYWdlID0gJyc7CgogIHN3aXRjaCAoJG1ldGhvZCkgewogICAgY2Fz
ZSAnZGVsZXRlJzoKCiAgICAgIGZvcmVhY2ggKCRzZWxlY3RlZCBhcyAkaWQpIHsKICAgICAg
ICBpZiAoc2FmZV9kZWxldGUoJ2FyY19yZWRpcmVjdCcsICdhcmNfcmVkaXJlY3RJRCA9ICcu
JGlkKSkgewogICAgICAgICAgJGNoYW5nZWRbXSA9ICRpZDsKICAgICAgICB9CiAgICAgIH0K
ICAgICAgJG1lc3NhZ2UgPSBjb3VudCgkY2hhbmdlZCkuJyByZWRpcmVjdHMgZGVsZXRlZCc7
CiAgICAgIGJyZWFrOwogIH0KCiAgYXJjX3JlZGlyZWN0X2xpc3QoJG1lc3NhZ2UpOwp9Cgov
LyBJbnN0YWxsYXRpb24gZnVuY3Rpb24gLSBidWlsZHMgTXlTUUwgdGFibGUKZnVuY3Rpb24g
YXJjX3JlZGlyZWN0X2luc3RhbGwoKQp7CgogIC8vIEZvciBmaXJzdCBpbnN0YWxsLCBjcmVh
dGUgdGFibGUgZm9yIHR3ZWV0cwogICRzcWwgPSAiQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElT
VFMgIi5QRlguImFyY19yZWRpcmVjdCAiOwogICRzcWwuPSAiKGFyY19yZWRpcmVjdElEIElO
VEVHRVIgQVVUT19JTkNSRU1FTlQgUFJJTUFSWSBLRVksCiAgICBvcmlnaW5hbFVybCBWQVJD
SEFSKDI0MCksCiAgICByZWRpcmVjdFVybCBWQVJDSEFSKDI0MCkpOyI7CgogIGlmICghc2Fm
ZV9xdWVyeSgkc3FsKSkgewogICAgcmV0dXJuICdFcnJvciAtIHVuYWJsZSB0byBjcmVhdGUg
YXJjX3JlZGlyZWN0IHRhYmxlJzsKICB9Cgp9CgovLyBVbmluc3RhbGwgZnVuY3Rpb24gLSBk
ZWxldGVzIE15U1FMIHRhYmxlIGFuZCByZWxhdGVkIHByZWZlcmVuY2VzCgpmdW5jdGlvbiBh
cmNfcmVkaXJlY3RfdW5pbnN0YWxsKCkKewogICRzcWwgPSAiRFJPUCBUQUJMRSBJRiBFWElT
VFMgIi5QRlguImFyY19yZWRpcmVjdDsiOwogIGlmICghc2FmZV9xdWVyeSgkc3FsKSkgewog
ICAgcmV0dXJuICdFcnJvciAtIHVuYWJsZSB0byBkZWxldGUgYXJjX3JlZGlyZWN0IHRhYmxl
JzsKICB9Cn0iO3M6MzoibWQ1IjtzOjMyOiIzZjgxMjg0YjJkYTg1MGY3MDgyYTdjNDQyZjcw
MjA0ZCI7fQ==
