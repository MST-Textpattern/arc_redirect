# arc_redirect v0.1-dev
# Love redirects, hate 404s
# Andy Carter
# http://redhotchilliproject.com/

# ......................................................................
# This is a plugin for Textpattern - http://textpattern.com/
# To install: textpattern > admin > plugins
# Paste the following text into the 'Install plugin' box:
# ......................................................................

YToxMTp7czo0OiJuYW1lIjtzOjEyOiJhcmNfcmVkaXJlY3QiO3M6NzoidmVyc2lvbiI7czo3
OiIwLjEtZGV2IjtzOjY6ImF1dGhvciI7czoxMToiQW5keSBDYXJ0ZXIiO3M6MTA6ImF1dGhv
cl91cmkiO3M6MzE6Imh0dHA6Ly9yZWRob3RjaGlsbGlwcm9qZWN0LmNvbS8iO3M6MTE6ImRl
c2NyaXB0aW9uIjtzOjI1OiJMb3ZlIHJlZGlyZWN0cywgaGF0ZSA0MDRzIjtzOjU6Im9yZGVy
IjtzOjE6IjUiO3M6NDoidHlwZSI7czoxOiIxIjtzOjU6ImZsYWdzIjtzOjE6IjIiO3M6NDoi
aGVscCI7czowOiIiO3M6NDoiY29kZSI7czo2OTc0OiJyZWdpc3Rlcl9jYWxsYmFjaygnYXJj
X3JlZGlyZWN0X2luc3RhbGwnLCdwbHVnaW5fbGlmZWN5Y2xlLmFyY19yZWRpcmVjdCcsICdp
bnN0YWxsZWQnKTsKcmVnaXN0ZXJfY2FsbGJhY2soJ2FyY19yZWRpcmVjdF91bmluc3RhbGwn
LCdwbHVnaW5fbGlmZWN5Y2xlLmFyY19yZWRpcmVjdCcsICdkZWxldGVkJyk7CnJlZ2lzdGVy
X2NhbGxiYWNrKCdhcmNfcmVkaXJlY3QnLCAndHhwX2RpZScsIDQwNCk7CmFkZF9wcml2cygn
YXJjX3JlZGlyZWN0JywgJzEsMiwzLDQnKTsKcmVnaXN0ZXJfdGFiKCdleHRlbnNpb25zJywg
J2FyY19yZWRpcmVjdCcsICdhcmNfcmVkaXJlY3QnKTsKcmVnaXN0ZXJfY2FsbGJhY2soJ2Fy
Y19yZWRpcmVjdF90YWInLCAnYXJjX3JlZGlyZWN0Jyk7CgovKgogKiBDaGVjayBmb3IgcmVk
aXJlY3RlZCBVUkxzIGFuZCBmb3J3YXJkIHdpdGggYSAzMDEgd2hlcmUgbmVjZXNzYXJ5Lgog
Ki8KZnVuY3Rpb24gYXJjX3JlZGlyZWN0KCRldmVudCwgJHN0ZXApIHsKICAkdXJsID0gUFJP
VE9DT0wuJF9TRVJWRVJbJ1NFUlZFUl9OQU1FJ10uJF9TRVJWRVJbJ1JFUVVFU1RfVVJJJ107
CgogIC8vIFN0cmlwIGZpbmFsIHNsYXNoIGZyb20gdXJsCiAgaWYgKHN1YnN0cigkdXJsLC0x
KT09Jy8nKSB7ICR1cmwgPSBzdWJzdHIoJHVybCwgMCwgLTEpOyB9CgogICRzcWwgPSAiU0VM
RUNUIHJlZGlyZWN0VXJsIEZST00gIi5QRlguImFyY19yZWRpcmVjdCBXSEVSRSBvcmlnaW5h
bFVybCA9ICciLiR1cmwuIic7IjsKICAkcnMgPSBzYWZlX3F1ZXJ5KCRzcWwpOyAkcmVkaXJl
Y3QgPSBuZXh0Um93KCRycyk7CgoJICBpZiAoJHJlZGlyZWN0WydyZWRpcmVjdFVybCddKSB7
CgkJICBvYl9lbmRfY2xlYW4oKTsKCgkJICBoZWFkZXIoIlN0YXR1czogMzAxIik7CgkJICBo
ZWFkZXIoIkhUVFAvMS4wIDMwMSBNb3ZlZCBQZXJtYW5lbnRseSIpOwoJCSAgaGVhZGVyKCJM
b2NhdGlvbjogIi4kcmVkaXJlY3RbJ3JlZGlyZWN0VXJsJ10sIFRSVUUsIDMwMSk7CgoJCSAg
Ly8gSW4gY2FzZSB0aGUgaGVhZGVyKCkgbWV0aG9kIGZhaWxzLCBmYWxsIGJhY2sgb24gYSBj
bGFzc2ljIHJlZGlyZWN0CgkJICBlY2hvICc8aHRtbD48aGVhZD48TUVUQSBIVFRQLUVRVUlW
PSJSZWZyZXNoIiBDT05URU5UPSIwO1VSTD0nCgkJICAgIC4kcGVybWxpbmsuJyI+PC9oZWFk
Pjxib2R5PjwvYm9keT48L2h0bWw+JzsKCQkgIGRpZSgpOwoJICB9Cgp9CgpmdW5jdGlvbiBh
cmNfcmVkaXJlY3RfdGFiKCRldmVudCwgJHN0ZXApIHsKICBzd2l0Y2ggKCRzdGVwKSB7CiAg
ICBjYXNlICdhZGQnOiBhcmNfcmVkaXJlY3RfYWRkKCk7IGJyZWFrOwogICAgY2FzZSAnc2F2
ZSc6IGFyY19yZWRpcmVjdF9zYXZlKCk7IGJyZWFrOwogICAgY2FzZSAnZWRpdCc6IGFyY19y
ZWRpcmVjdF9lZGl0KCk7IGJyZWFrOwogICAgY2FzZSAnYXJjX3JlZGlyZWN0X211bHRpX2Vk
aXQnOiBhcmNfcmVkaXJlY3RfbXVsdGllZGl0KCk7IGJyZWFrOwogICAgZGVmYXVsdDogYXJj
X3JlZGlyZWN0X2xpc3QoKTsKICB9Cn0KCmZ1bmN0aW9uIGFyY19yZWRpcmVjdF9saXN0KCRt
ZXNzYWdlID0gJycpIHsKCiAgcGFnZXRvcCgnYXJjX3JlZGlyZWN0JywkbWVzc2FnZSk7Cgog
ICRzcWwgPSAiU0VMRUNUICogRlJPTSAiLlBGWC4iYXJjX3JlZGlyZWN0OyI7CiAgJHJzID0g
c2FmZV9xdWVyeSgkc3FsKTsKCiAgLy8gSW5jbHVkZSBhIHF1aWNrIGFkZCBmb3JtCiAgJGh0
bWwgPSBmb3JtKAogICAgc3RhcnRUYWJsZSgnZWRpdCcpCiAgICAgIC50cigKICAgICAgICB0
ZGEodGFnKCdPcmlnaW5hbCBVUkwnLCdsYWJlbCcsICcgZm9yPSJvcmlnaW5hbFVybCInKSwn
IHN0eWxlPSJ2ZXJ0aWNhbC1hbGlnbjptaWRkbGUiJykKICAgICAgICAudGQoZklucHV0KCd0
ZXh0Jywnb3JpZ2luYWxVcmwnLCcnLCdlZGl0JywnJywnJywnJywnJywnb3JpZ2luYWxVcmwn
KSkKICAgICAgKS50cigKICAgICAgICB0ZGEodGFnKCdSZWRpcmVjdCBVUkwnLCdsYWJlbCcs
ICcgZm9yPSJyZWRpcmVjdFVybCInKSwnIHN0eWxlPSJ2ZXJ0aWNhbC1hbGlnbjptaWRkbGUi
JykKICAgICAgICAudGQoZklucHV0KCd0ZXh0JywncmVkaXJlY3RVcmwnLCcnLCdlZGl0Jywn
JywnJywnJywnJywncmVkaXJlY3RVcmwnKQogICAgICAgIC5lSW5wdXQoJ2FyY19yZWRpcmVj
dCcpCiAgICAgICAgLnNJbnB1dCgnYWRkJykuJyZuYnNwOycuZklucHV0KCdzdWJtaXQnLCdh
ZGQnLGdUeHQoJ0FkZCcpLCdwdWJsaXNoJykKICAgICAgICApCiAgICAgICkKICAgIC5lbmRU
YWJsZSgpCiAgLCAnbWFyZ2luLWJvdHRvbToyNXB4Jyk7CgogIC8vIEFkZCBhIGxpc3Qgb2Yg
ZXhpc3RpbmcgcmVkaXJlY3RzCiAgJGh0bWwgLj0gbi5uLic8Zm9ybSBhY3Rpb249ImluZGV4
LnBocCIgaWQ9ImFyY19yZWRpcmVjdF9mb3JtIiBtZXRob2Q9InBvc3QiIG5hbWU9Imxvbmdm
b3JtIiBvbnN1Ym1pdD0icmV0dXJuIHZlcmlmeShcJycuZ1R4dCgnYXJlX3lvdV9zdXJlJyku
J1wnKSI+JzsKICAkaHRtbCAuPSBzdGFydFRhYmxlKCdsaXN0Jyk7CgogICRodG1sIC49IHRy
KAogICAgaENlbGwgKCdJRCMnKQogICAgLmhDZWxsICgpCiAgICAuaENlbGwgKCdPcmlnaW5h
bCBVUkwnKQogICAgLmhDZWxsICgnUmVkaXJlY3QgVVJMJykKICApOwoKICB3aGlsZSAoJHJl
ZGlyZWN0ID0gbmV4dFJvdygkcnMpKSB7CiAgICAkZWRpdExpbmsgPSBocmVmKGdUeHQoJ2Vk
aXQnKSwKICAgICAgJz9ldmVudD1hcmNfcmVkaXJlY3QmYW1wO3N0ZXA9ZWRpdCZhbXA7aWQ9
Jy4kcmVkaXJlY3RbJ2FyY19yZWRpcmVjdElEJ10pOwogICAgJHJlZGlyZWN0TGluayA9IGhy
ZWYoJ1Rlc3QnLCRyZWRpcmVjdFsnb3JpZ2luYWxVcmwnXSk7CiAgICAkaHRtbCAuPSB0cigK
ICAgICAgdGQoJHJlZGlyZWN0WydhcmNfcmVkaXJlY3RJRCddLCAyMCwgJ2lkJykKICAgICAg
LnRkKCI8dWw+PGxpIGNsYXNzPSdhY3Rpb24tZWRpdCc+JGVkaXRMaW5rPC9saT48bGkgY2xh
c3M9J2FjdGlvbi12aWV3Jz4kcmVkaXJlY3RMaW5rPC9saT48L3VsPiIsIDM1LCAnYWN0aW9u
cycpCiAgICAgIC50ZCgkcmVkaXJlY3RbJ29yaWdpbmFsVXJsJ10sIDE3NSkKICAgICAgLnRk
KCRyZWRpcmVjdFsncmVkaXJlY3RVcmwnXSwgMTc1KQogICAgICAudGQoZklucHV0KCdjaGVj
a2JveCcsICdzZWxlY3RlZFtdJywgJHJlZGlyZWN0WydhcmNfcmVkaXJlY3RJRCddKSwgJycs
ICdtdWx0aS1lZGl0JykKICAgICk7CiAgfQoKICAkaHRtbCAuPSBuLic8dGZvb3Q+Jy50cigK
ICAgICAgdGRhKHNlbGVjdF9idXR0b25zKCkKICAgICAgLmV2ZW50X211bHRpZWRpdF9mb3Jt
KCdhcmNfcmVkaXJlY3QnLCBhcnJheSgnZGVsZXRlJz0+Z1R4dCgnZGVsZXRlJykpLDEsJycs
JycsJycsJycpLAogICAgICAnIGNsYXNzPSJtdWx0aS1lZGl0IiBjb2xzcGFuPSI1IiBzdHls
ZT0idGV4dC1hbGlnbjpyaWdodDtib3JkZXI6bm9uZSInKQogICAgKS5uLic8L3Rmb290Pic7
CgogICRodG1sIC49IGVuZFRhYmxlKCk7CiAgJGh0bWwgLj0gJzwvZm9ybT4nOwoKICBlY2hv
ICRodG1sOwoKfQoKZnVuY3Rpb24gYXJjX3JlZGlyZWN0X2VkaXQoJG1lc3NhZ2U9JycpIHsK
ICBwYWdldG9wKCdhcmNfcmVkaXJlY3QnLCRtZXNzYWdlKTsKCiAgJG9yaWdpbmFsVXJsID0g
Z3BzKCdvcmlnaW5hbFVybCcpOwogICRyZWRpcmVjdFVybCA9IGdwcygncmVkaXJlY3RVcmwn
KTsKCiAgaWYgKCRpZD1ncHMoJ2lkJykpIHsKICAgICRycyA9IHNhZmVfcm93KCdvcmlnaW5h
bFVybCxyZWRpcmVjdFVybCcsICdhcmNfcmVkaXJlY3QnLCAiYXJjX3JlZGlyZWN0SUQgPSAk
aWQiKTsKICAgIGV4dHJhY3QoJHJzKTsKICB9CgogICRodG1sID0gZm9ybSgKICAgIHN0YXJ0
VGFibGUoJ2VkaXQnKQogICAgICAudHIoCiAgICAgICAgdGRhKHRhZygnT3JpZ2luYWwgVVJM
JywnbGFiZWwnLCAnIGZvcj0ib3JpZ2luYWxVcmwiJyksJyBzdHlsZT0idmVydGljYWwtYWxp
Z246bWlkZGxlIicpCiAgICAgICAgLnRkKGZJbnB1dCgndGV4dCcsJ29yaWdpbmFsVXJsJywk
b3JpZ2luYWxVcmwsJ2VkaXQnLCcnLCcnLCcnLCcnLCdvcmlnaW5hbFVybCcpKQogICAgICAp
LnRyKAogICAgICAgIHRkYSh0YWcoJ1JlZGlyZWN0IFVSTCcsJ2xhYmVsJywgJyBmb3I9InJl
ZGlyZWN0VXJsIicpLCcgc3R5bGU9InZlcnRpY2FsLWFsaWduOm1pZGRsZSInKQogICAgICAg
IC50ZChmSW5wdXQoJ3RleHQnLCdyZWRpcmVjdFVybCcsJHJlZGlyZWN0VXJsLCdlZGl0Jywn
JywnJywnJywnJywncmVkaXJlY3RVcmwnKQogICAgICAgIC5lSW5wdXQoJ2FyY19yZWRpcmVj
dCcpLicmbmJzcDsnCiAgICAgICAgLigoJGlkKT8KICAgICAgICBzSW5wdXQoJ3NhdmUnKS5o
SW5wdXQoJ2lkJywkaWQpLmZJbnB1dCgnc3VibWl0Jywnc2F2ZScsZ1R4dCgnU2F2ZScpLCdw
dWJsaXNoJykKICAgICAgICAgIDpzSW5wdXQoJ2FkZCcpLmZJbnB1dCgnc3VibWl0JywnYWRk
JyxnVHh0KCdBZGQnKSwncHVibGlzaCcpCiAgICAgICAgKSkKICAgICAgKQogICAgLmVuZFRh
YmxlKCkKICApOwoKICBlY2hvICRodG1sOwoKfQoKZnVuY3Rpb24gYXJjX3JlZGlyZWN0X2Fk
ZCgpIHsKICAkb3JpZ2luYWxVcmwgPSBncHMoJ29yaWdpbmFsVXJsJyk7CiAgJHJlZGlyZWN0
VXJsID0gZ3BzKCdyZWRpcmVjdFVybCcpOwoKICBpZiAoJG9yaWdpbmFsVXJsID09PSAnJyB8
fCAkcmVkaXJlY3RVcmwgPT09ICcnKSB7CiAgICBhcmNfcmVkaXJlY3RfZWRpdCgnVW5hYmxl
IHRvIGFkZCBuZXcgcmVkaXJlY3QnKTsKICAgIHJldHVybjsKICB9CgogIC8vIFN0cmlwIGZp
bmFsIHNsYXNoIGZyb20gb3JpZ2luYWwgdXJsCiAgaWYgKHN1YnN0cigkb3JpZ2luYWxVcmws
LTEpPT0nLycpIHsKICAgICRvcmlnaW5hbFVybCA9IHN1YnN0cigkb3JpZ2luYWxVcmwsIDAs
IC0xKTsKICB9CgogICRxID0gc2FmZV9pbnNlcnQoImFyY19yZWRpcmVjdCIsCiAgICAib3Jp
Z2luYWxVcmwgPSAnIi50cmltKCRvcmlnaW5hbFVybCkuIicsIHJlZGlyZWN0VXJsID0gJyIu
dHJpbSgkcmVkaXJlY3RVcmwpLiInIgogICk7CgogICRHTE9CQUxTWydJRCddID0gbXlzcWxf
aW5zZXJ0X2lkKCk7CgogIGlmICgkcSkgewogICAgJG1lc3NhZ2UgPSBnVHh0KCdSZWRpcmVj
dCBhZGRlZCcpOwogICAgYXJjX3JlZGlyZWN0X2xpc3QoJG1lc3NhZ2UpOwogIH0KfQoKZnVu
Y3Rpb24gYXJjX3JlZGlyZWN0X3NhdmUoKSB7CgogIGlmICghJGlkPWdwcygnaWQnKSkgewog
ICAgYXJjX3JlZGlyZWN0X2xpc3QoJ1VuYWJsZSB0byBzYXZlIHJlZGlyZWN0Jyk7CiAgICBy
ZXR1cm47CiAgfQoKICAkb3JpZ2luYWxVcmwgPSBncHMoJ29yaWdpbmFsVXJsJyk7CiAgJHJl
ZGlyZWN0VXJsID0gZ3BzKCdyZWRpcmVjdFVybCcpOwoKICBpZiAoJG9yaWdpbmFsVXJsID09
ICcnIHx8ICRyZWRpcmVjdFVybCA9PSAnJykgewogICAgYXJjX3JlZGlyZWN0X2VkaXQoJ1Vu
YWJsZSB0byBzYXZlIHJlZGlyZWN0Jyk7CiAgICByZXR1cm47CiAgfQoKICAvLyBTdHJpcCBm
aW5hbCBzbGFzaCBmcm9tIG9yaWdpbmFsIHVybAogIGlmIChzdWJzdHIoJG9yaWdpbmFsVXJs
LC0xKT09Jy8nKSB7CiAgICAkb3JpZ2luYWxVcmwgPSBzdWJzdHIoJG9yaWdpbmFsVXJsLCAw
LCAtMSk7CiAgfQoKICAkcnMgPSBzYWZlX3VwZGF0ZSgiYXJjX3JlZGlyZWN0IiwKICAgICJv
cmlnaW5hbFVybCAgICA9ICciLnRyaW0oJG9yaWdpbmFsVXJsKS4iJywgIHJlZGlyZWN0VXJs
ID0gJyIudHJpbSgkcmVkaXJlY3RVcmwpLiInIiwKICAgICJhcmNfcmVkaXJlY3RJRCA9ICRp
ZCIKICApOwoKICBpZiAoJHJzKSB7CiAgICAkbWVzc2FnZSA9IGdUeHQoJ1JlZGlyZWN0IHVw
ZGF0ZWQnKTsKICAgIGFyY19yZWRpcmVjdF9saXN0KCRtZXNzYWdlKTsKICB9Cn0KCmZ1bmN0
aW9uIGFyY19yZWRpcmVjdF9tdWx0aWVkaXQoKSB7CiAgJHNlbGVjdGVkID0gcHMoJ3NlbGVj
dGVkJyk7CgogIGlmICghJHNlbGVjdGVkIHx8ICFpc19hcnJheSgkc2VsZWN0ZWQpKSB7CiAg
ICBhcmNfcmVkaXJlY3RfbGlzdCgpOwogICAgcmV0dXJuOwogIH0KCiAgJG1ldGhvZCA9IHBz
KCdlZGl0X21ldGhvZCcpOwogICRjaGFuZ2VkID0gYXJyYXkoKTsKCiAgJG1lc3NhZ2UgPSAn
JzsKCiAgc3dpdGNoICgkbWV0aG9kKSB7CiAgICBjYXNlICdkZWxldGUnOgoKICAgICAgZm9y
ZWFjaCAoJHNlbGVjdGVkIGFzICRpZCkgewogICAgICAgIGlmIChzYWZlX2RlbGV0ZSgnYXJj
X3JlZGlyZWN0JywgJ2FyY19yZWRpcmVjdElEID0gJy4kaWQpKSB7CiAgICAgICAgICAkY2hh
bmdlZFtdID0gJGlkOwogICAgICAgIH0KICAgICAgfQogICAgICAkbWVzc2FnZSA9IGNvdW50
KCRjaGFuZ2VkKS4nIHJlZGlyZWN0cyBkZWxldGVkJzsKICAgICAgYnJlYWs7CiAgfQoKICBh
cmNfcmVkaXJlY3RfbGlzdCgkbWVzc2FnZSk7Cn0KCi8vIEluc3RhbGxhdGlvbiBmdW5jdGlv
biAtIGJ1aWxkcyBNeVNRTCB0YWJsZQpmdW5jdGlvbiBhcmNfcmVkaXJlY3RfaW5zdGFsbCgp
CnsKCiAgLy8gRm9yIGZpcnN0IGluc3RhbGwsIGNyZWF0ZSB0YWJsZSBmb3IgdHdlZXRzCiAg
JHNxbCA9ICJDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyAiLlBGWC4iYXJjX3JlZGlyZWN0
ICI7CiAgJHNxbC49ICIoYXJjX3JlZGlyZWN0SUQgSU5URUdFUiBBVVRPX0lOQ1JFTUVOVCBQ
UklNQVJZIEtFWSwKICAgIG9yaWdpbmFsVXJsIFZBUkNIQVIoMjQwKSwKICAgIHJlZGlyZWN0
VXJsIFZBUkNIQVIoMjQwKSk7IjsKCiAgaWYgKCFzYWZlX3F1ZXJ5KCRzcWwpKSB7CiAgICBy
ZXR1cm4gJ0Vycm9yIC0gdW5hYmxlIHRvIGNyZWF0ZSBhcmNfcmVkaXJlY3QgdGFibGUnOwog
IH0KCn0KCi8vIFVuaW5zdGFsbCBmdW5jdGlvbiAtIGRlbGV0ZXMgTXlTUUwgdGFibGUgYW5k
IHJlbGF0ZWQgcHJlZmVyZW5jZXMKCmZ1bmN0aW9uIGFyY19yZWRpcmVjdF91bmluc3RhbGwo
KQp7CiAgJHNxbCA9ICJEUk9QIFRBQkxFIElGIEVYSVNUUyAiLlBGWC4iYXJjX3JlZGlyZWN0
OyI7CiAgaWYgKCFzYWZlX3F1ZXJ5KCRzcWwpKSB7CiAgICByZXR1cm4gJ0Vycm9yIC0gdW5h
YmxlIHRvIGRlbGV0ZSBhcmNfcmVkaXJlY3QgdGFibGUnOwogIH0KfSI7czozOiJtZDUiO3M6
MzI6IjIxNzJiYzcyMjhjMjk3OThhYTliMmQyYmExMmUyNzgzIjt9
